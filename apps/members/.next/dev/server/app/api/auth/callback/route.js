/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/callback/route";
exports.ids = ["app/api/auth/callback/route"];
exports.modules = {

/***/ "(rsc)/./app/api/auth/callback/route.ts":
/*!****************************************!*\
  !*** ./app/api/auth/callback/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_auth_return_to__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/return-to */ \"(rsc)/./lib/auth/return-to.ts\");\n/* harmony import */ var _lib_auth_callback_state__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth/callback-state */ \"(rsc)/./lib/auth/callback-state.ts\");\n/* harmony import */ var _lib_auth_session__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth/session */ \"(rsc)/./lib/auth/session.ts\");\n/* harmony import */ var _lib_auth_stytch__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/auth/stytch */ \"(rsc)/./lib/auth/stytch.ts\");\n/* harmony import */ var _lib_logging_server__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/logging/server */ \"(rsc)/./lib/logging/server.ts\");\n/* harmony import */ var _lib_newsletter_buttondown__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/newsletter/buttondown */ \"(rsc)/./lib/newsletter/buttondown.ts\");\n\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nconst isMagicLinkToken = (tokenType)=>tokenType === \"magic_link\" || tokenType === \"magic_links\";\nconst loginErrorRedirect = (request, code)=>{\n    const url = new URL(\"/login\", request.url);\n    url.searchParams.set(\"error\", code);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url, 302);\n};\nasync function GET(request) {\n    const url = new URL(request.url);\n    const token = url.searchParams.get(\"token\");\n    const tokenType = url.searchParams.get(\"stytch_token_type\");\n    const queryReturnTo = (0,_lib_auth_return_to__WEBPACK_IMPORTED_MODULE_1__.normalizeReturnTo)(url.searchParams.get(\"returnTo\"));\n    const querySubscribe = url.searchParams.get(\"subscribe\");\n    const callbackState = (0,_lib_auth_callback_state__WEBPACK_IMPORTED_MODULE_2__.readAuthCallbackState)(request);\n    const cookieReturnTo = (0,_lib_auth_return_to__WEBPACK_IMPORTED_MODULE_1__.normalizeReturnTo)(callbackState.returnTo);\n    const returnTo = queryReturnTo ?? cookieReturnTo;\n    const shouldSubscribe = querySubscribe ? querySubscribe !== \"0\" : callbackState.subscribe;\n    const logger = (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_5__.createRequestLogger)(request, {\n        scope: \"auth.callback\"\n    });\n    logger.info(\"auth.callback.requested\", {\n        hasToken: Boolean(token),\n        tokenType,\n        returnTo,\n        subscribe: shouldSubscribe\n    });\n    if (!token || tokenType && !isMagicLinkToken(tokenType)) {\n        logger.warn(\"auth.callback.invalid_link\", {\n            hasToken: Boolean(token),\n            tokenType\n        });\n        const response = loginErrorRedirect(request, \"invalid-link\");\n        (0,_lib_auth_callback_state__WEBPACK_IMPORTED_MODULE_2__.clearAuthCallbackState)(response);\n        return response;\n    }\n    try {\n        const client = (0,_lib_auth_stytch__WEBPACK_IMPORTED_MODULE_4__.getStytchClient)();\n        const result = await client.magicLinks.authenticate({\n            token,\n            session_duration_minutes: _lib_auth_session__WEBPACK_IMPORTED_MODULE_3__.SESSION_DURATION_MINUTES\n        });\n        logger.info(\"auth.callback.authenticated\", {\n            userId: result.user.user_id,\n            hasSession: Boolean(result.session_token),\n            subscribe: shouldSubscribe\n        });\n        const destination = new URL(returnTo ?? \"/\", request.url);\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(destination, 302);\n        response.cookies.set(_lib_auth_session__WEBPACK_IMPORTED_MODULE_3__.SESSION_COOKIE_NAME, result.session_token, _lib_auth_session__WEBPACK_IMPORTED_MODULE_3__.sessionCookieOptions);\n        (0,_lib_auth_callback_state__WEBPACK_IMPORTED_MODULE_2__.clearAuthCallbackState)(response);\n        if (shouldSubscribe) {\n            const primaryEmail = result.user.emails.find((email)=>email.verified)?.email ?? result.user.emails[0]?.email ?? null;\n            if (primaryEmail) {\n                const emailMeta = (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_5__.emailToLogMeta)(primaryEmail);\n                const origin = process.env.APP_ORIGIN ?? url.origin;\n                const subscribeResult = await (0,_lib_newsletter_buttondown__WEBPACK_IMPORTED_MODULE_6__.subscribeToButtondown)({\n                    email: primaryEmail,\n                    returnTo,\n                    origin,\n                    logger: logger.child({\n                        scope: \"newsletter.buttondown\"\n                    })\n                });\n                if (subscribeResult.status === \"subscribed\" || subscribeResult.status === \"already_subscribed\") {\n                    response.cookies.set(_lib_newsletter_buttondown__WEBPACK_IMPORTED_MODULE_6__.SUBSCRIBED_COOKIE_NAME, \"1\", _lib_newsletter_buttondown__WEBPACK_IMPORTED_MODULE_6__.subscribedCookieOptions);\n                    logger.info(\"auth.callback.subscribe_completed\", {\n                        ...emailMeta,\n                        status: subscribeResult.status\n                    });\n                } else if (subscribeResult.status === \"failed\") {\n                    logger.warn(\"auth.callback.subscribe_failed\", {\n                        ...emailMeta,\n                        error: subscribeResult.error\n                    });\n                }\n            } else {\n                logger.warn(\"auth.callback.subscribe_missing_email\");\n            }\n        }\n        return response;\n    } catch (error) {\n        logger.error(\"auth.callback.failed\", {\n            error: (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_5__.serializeError)(error)\n        });\n        const response = loginErrorRedirect(request, \"link-expired\");\n        response.cookies.set(_lib_auth_session__WEBPACK_IMPORTED_MODULE_3__.SESSION_COOKIE_NAME, \"\", {\n            ..._lib_auth_session__WEBPACK_IMPORTED_MODULE_3__.sessionCookieOptions,\n            maxAge: 0\n        });\n        (0,_lib_auth_callback_state__WEBPACK_IMPORTED_MODULE_2__.clearAuthCallbackState)(response);\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSXdDLE1BQU07Z0JBQ25ELE1BQU1JLGtCQUFrQixNQUFNcEQsaUZBQXFCQSxDQUFDO29CQUNsRDZDLE9BQU9IO29CQUNQdEI7b0JBQ0E0QjtvQkFDQXpCLFFBQVFBLE9BQU84QixLQUFLLENBQUM7d0JBQUU3QixPQUFPO29CQUF3QjtnQkFDeEQ7Z0JBQ0EsSUFDRTRCLGdCQUFnQkUsTUFBTSxLQUFLLGdCQUMzQkYsZ0JBQWdCRSxNQUFNLEtBQUssc0JBQzNCO29CQUNBekIsU0FBU1ksT0FBTyxDQUFDOUIsR0FBRyxDQUNsQlosOEVBQXNCQSxFQUN0QixLQUNBRSwrRUFBdUJBO29CQUV6QnNCLE9BQU9FLElBQUksQ0FBQyxxQ0FBcUM7d0JBQy9DLEdBQUdzQixTQUFTO3dCQUNaTyxRQUFRRixnQkFBZ0JFLE1BQU07b0JBQ2hDO2dCQUNGLE9BQU8sSUFBSUYsZ0JBQWdCRSxNQUFNLEtBQUssVUFBVTtvQkFDOUMvQixPQUFPSyxJQUFJLENBQUMsa0NBQWtDO3dCQUM1QyxHQUFHbUIsU0FBUzt3QkFDWlEsT0FBT0gsZ0JBQWdCRyxLQUFLO29CQUM5QjtnQkFDRjtZQUNGLE9BQU87Z0JBQ0xoQyxPQUFPSyxJQUFJLENBQUM7WUFDZDtRQUNGO1FBRUEsT0FBT0M7SUFDVCxFQUFFLE9BQU8wQixPQUFPO1FBQ2RoQyxPQUFPZ0MsS0FBSyxDQUFDLHdCQUF3QjtZQUNuQ0EsT0FBT3pELG1FQUFjQSxDQUFDeUQ7UUFDeEI7UUFDQSxNQUFNMUIsV0FBV3hCLG1CQUFtQkMsU0FBUztRQUM3Q3VCLFNBQVNZLE9BQU8sQ0FBQzlCLEdBQUcsQ0FBQ25CLGtFQUFtQkEsRUFBRSxJQUFJO1lBQzVDLEdBQUdFLG1FQUFvQjtZQUN2QjhELFFBQVE7UUFDVjtRQUNBbEUsZ0ZBQXNCQSxDQUFDdUM7UUFDdkIsT0FBT0E7SUFDVDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvcnlhbnJvc3p0b2N6eS9EZXZlbG9wbWVudC9tYWluc3RyZWV0YWktd2Vic2l0ZS9hcHBzL21lbWJlcnMvYXBwL2FwaS9hdXRoL2NhbGxiYWNrL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHR5cGUgeyBOZXh0UmVxdWVzdCB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuXG5pbXBvcnQgeyBub3JtYWxpemVSZXR1cm5UbyB9IGZyb20gXCJAL2xpYi9hdXRoL3JldHVybi10b1wiO1xuaW1wb3J0IHtcbiAgY2xlYXJBdXRoQ2FsbGJhY2tTdGF0ZSxcbiAgcmVhZEF1dGhDYWxsYmFja1N0YXRlLFxufSBmcm9tIFwiQC9saWIvYXV0aC9jYWxsYmFjay1zdGF0ZVwiO1xuaW1wb3J0IHtcbiAgU0VTU0lPTl9DT09LSUVfTkFNRSxcbiAgU0VTU0lPTl9EVVJBVElPTl9NSU5VVEVTLFxuICBzZXNzaW9uQ29va2llT3B0aW9ucyxcbn0gZnJvbSBcIkAvbGliL2F1dGgvc2Vzc2lvblwiO1xuaW1wb3J0IHsgZ2V0U3R5dGNoQ2xpZW50IH0gZnJvbSBcIkAvbGliL2F1dGgvc3R5dGNoXCI7XG5pbXBvcnQge1xuICBjcmVhdGVSZXF1ZXN0TG9nZ2VyLFxuICBlbWFpbFRvTG9nTWV0YSxcbiAgc2VyaWFsaXplRXJyb3IsXG59IGZyb20gXCJAL2xpYi9sb2dnaW5nL3NlcnZlclwiO1xuaW1wb3J0IHtcbiAgU1VCU0NSSUJFRF9DT09LSUVfTkFNRSxcbiAgc3Vic2NyaWJlVG9CdXR0b25kb3duLFxuICBzdWJzY3JpYmVkQ29va2llT3B0aW9ucyxcbn0gZnJvbSBcIkAvbGliL25ld3NsZXR0ZXIvYnV0dG9uZG93blwiO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7XG5cbmNvbnN0IGlzTWFnaWNMaW5rVG9rZW4gPSAodG9rZW5UeXBlOiBzdHJpbmcgfCBudWxsKSA9PlxuICB0b2tlblR5cGUgPT09IFwibWFnaWNfbGlua1wiIHx8IHRva2VuVHlwZSA9PT0gXCJtYWdpY19saW5rc1wiO1xuXG5jb25zdCBsb2dpbkVycm9yUmVkaXJlY3QgPSAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGNvZGU6IHN0cmluZykgPT4ge1xuICBjb25zdCB1cmwgPSBuZXcgVVJMKFwiL2xvZ2luXCIsIHJlcXVlc3QudXJsKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJlcnJvclwiLCBjb2RlKTtcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdCh1cmwsIDMwMik7XG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICBjb25zdCB0b2tlbiA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KFwidG9rZW5cIik7XG4gIGNvbnN0IHRva2VuVHlwZSA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KFwic3R5dGNoX3Rva2VuX3R5cGVcIik7XG4gIGNvbnN0IHF1ZXJ5UmV0dXJuVG8gPSBub3JtYWxpemVSZXR1cm5Ubyh1cmwuc2VhcmNoUGFyYW1zLmdldChcInJldHVyblRvXCIpKTtcbiAgY29uc3QgcXVlcnlTdWJzY3JpYmUgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcInN1YnNjcmliZVwiKTtcbiAgY29uc3QgY2FsbGJhY2tTdGF0ZSA9IHJlYWRBdXRoQ2FsbGJhY2tTdGF0ZShyZXF1ZXN0KTtcbiAgY29uc3QgY29va2llUmV0dXJuVG8gPSBub3JtYWxpemVSZXR1cm5UbyhjYWxsYmFja1N0YXRlLnJldHVyblRvKTtcbiAgY29uc3QgcmV0dXJuVG8gPSBxdWVyeVJldHVyblRvID8/IGNvb2tpZVJldHVyblRvO1xuICBjb25zdCBzaG91bGRTdWJzY3JpYmUgPSBxdWVyeVN1YnNjcmliZVxuICAgID8gcXVlcnlTdWJzY3JpYmUgIT09IFwiMFwiXG4gICAgOiBjYWxsYmFja1N0YXRlLnN1YnNjcmliZTtcbiAgY29uc3QgbG9nZ2VyID0gY3JlYXRlUmVxdWVzdExvZ2dlcihyZXF1ZXN0LCB7IHNjb3BlOiBcImF1dGguY2FsbGJhY2tcIiB9KTtcblxuICBsb2dnZXIuaW5mbyhcImF1dGguY2FsbGJhY2sucmVxdWVzdGVkXCIsIHtcbiAgICBoYXNUb2tlbjogQm9vbGVhbih0b2tlbiksXG4gICAgdG9rZW5UeXBlLFxuICAgIHJldHVyblRvLFxuICAgIHN1YnNjcmliZTogc2hvdWxkU3Vic2NyaWJlLFxuICB9KTtcblxuICBpZiAoIXRva2VuIHx8ICh0b2tlblR5cGUgJiYgIWlzTWFnaWNMaW5rVG9rZW4odG9rZW5UeXBlKSkpIHtcbiAgICBsb2dnZXIud2FybihcImF1dGguY2FsbGJhY2suaW52YWxpZF9saW5rXCIsIHtcbiAgICAgIGhhc1Rva2VuOiBCb29sZWFuKHRva2VuKSxcbiAgICAgIHRva2VuVHlwZSxcbiAgICB9KTtcbiAgICBjb25zdCByZXNwb25zZSA9IGxvZ2luRXJyb3JSZWRpcmVjdChyZXF1ZXN0LCBcImludmFsaWQtbGlua1wiKTtcbiAgICBjbGVhckF1dGhDYWxsYmFja1N0YXRlKHJlc3BvbnNlKTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudCA9IGdldFN0eXRjaENsaWVudCgpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tYWdpY0xpbmtzLmF1dGhlbnRpY2F0ZSh7XG4gICAgICB0b2tlbixcbiAgICAgIHNlc3Npb25fZHVyYXRpb25fbWludXRlczogU0VTU0lPTl9EVVJBVElPTl9NSU5VVEVTLFxuICAgIH0pO1xuICAgIGxvZ2dlci5pbmZvKFwiYXV0aC5jYWxsYmFjay5hdXRoZW50aWNhdGVkXCIsIHtcbiAgICAgIHVzZXJJZDogcmVzdWx0LnVzZXIudXNlcl9pZCxcbiAgICAgIGhhc1Nlc3Npb246IEJvb2xlYW4ocmVzdWx0LnNlc3Npb25fdG9rZW4pLFxuICAgICAgc3Vic2NyaWJlOiBzaG91bGRTdWJzY3JpYmUsXG4gICAgfSk7XG5cbiAgICBjb25zdCBkZXN0aW5hdGlvbiA9IG5ldyBVUkwocmV0dXJuVG8gPz8gXCIvXCIsIHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChkZXN0aW5hdGlvbiwgMzAyKTtcbiAgICByZXNwb25zZS5jb29raWVzLnNldChcbiAgICAgIFNFU1NJT05fQ09PS0lFX05BTUUsXG4gICAgICByZXN1bHQuc2Vzc2lvbl90b2tlbixcbiAgICAgIHNlc3Npb25Db29raWVPcHRpb25zLFxuICAgICk7XG4gICAgY2xlYXJBdXRoQ2FsbGJhY2tTdGF0ZShyZXNwb25zZSk7XG5cbiAgICBpZiAoc2hvdWxkU3Vic2NyaWJlKSB7XG4gICAgICBjb25zdCBwcmltYXJ5RW1haWwgPVxuICAgICAgICByZXN1bHQudXNlci5lbWFpbHMuZmluZCgoZW1haWwpID0+IGVtYWlsLnZlcmlmaWVkKT8uZW1haWwgPz9cbiAgICAgICAgcmVzdWx0LnVzZXIuZW1haWxzWzBdPy5lbWFpbCA/P1xuICAgICAgICBudWxsO1xuICAgICAgaWYgKHByaW1hcnlFbWFpbCkge1xuICAgICAgICBjb25zdCBlbWFpbE1ldGEgPSBlbWFpbFRvTG9nTWV0YShwcmltYXJ5RW1haWwpO1xuICAgICAgICBjb25zdCBvcmlnaW4gPSBwcm9jZXNzLmVudi5BUFBfT1JJR0lOID8/IHVybC5vcmlnaW47XG4gICAgICAgIGNvbnN0IHN1YnNjcmliZVJlc3VsdCA9IGF3YWl0IHN1YnNjcmliZVRvQnV0dG9uZG93bih7XG4gICAgICAgICAgZW1haWw6IHByaW1hcnlFbWFpbCxcbiAgICAgICAgICByZXR1cm5UbyxcbiAgICAgICAgICBvcmlnaW4sXG4gICAgICAgICAgbG9nZ2VyOiBsb2dnZXIuY2hpbGQoeyBzY29wZTogXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd25cIiB9KSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBzdWJzY3JpYmVSZXN1bHQuc3RhdHVzID09PSBcInN1YnNjcmliZWRcIiB8fFxuICAgICAgICAgIHN1YnNjcmliZVJlc3VsdC5zdGF0dXMgPT09IFwiYWxyZWFkeV9zdWJzY3JpYmVkXCJcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXG4gICAgICAgICAgICBTVUJTQ1JJQkVEX0NPT0tJRV9OQU1FLFxuICAgICAgICAgICAgXCIxXCIsXG4gICAgICAgICAgICBzdWJzY3JpYmVkQ29va2llT3B0aW9ucyxcbiAgICAgICAgICApO1xuICAgICAgICAgIGxvZ2dlci5pbmZvKFwiYXV0aC5jYWxsYmFjay5zdWJzY3JpYmVfY29tcGxldGVkXCIsIHtcbiAgICAgICAgICAgIC4uLmVtYWlsTWV0YSxcbiAgICAgICAgICAgIHN0YXR1czogc3Vic2NyaWJlUmVzdWx0LnN0YXR1cyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChzdWJzY3JpYmVSZXN1bHQuc3RhdHVzID09PSBcImZhaWxlZFwiKSB7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oXCJhdXRoLmNhbGxiYWNrLnN1YnNjcmliZV9mYWlsZWRcIiwge1xuICAgICAgICAgICAgLi4uZW1haWxNZXRhLFxuICAgICAgICAgICAgZXJyb3I6IHN1YnNjcmliZVJlc3VsdC5lcnJvcixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXCJhdXRoLmNhbGxiYWNrLnN1YnNjcmliZV9taXNzaW5nX2VtYWlsXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoXCJhdXRoLmNhbGxiYWNrLmZhaWxlZFwiLCB7XG4gICAgICBlcnJvcjogc2VyaWFsaXplRXJyb3IoZXJyb3IpLFxuICAgIH0pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gbG9naW5FcnJvclJlZGlyZWN0KHJlcXVlc3QsIFwibGluay1leHBpcmVkXCIpO1xuICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFNFU1NJT05fQ09PS0lFX05BTUUsIFwiXCIsIHtcbiAgICAgIC4uLnNlc3Npb25Db29raWVPcHRpb25zLFxuICAgICAgbWF4QWdlOiAwLFxuICAgIH0pO1xuICAgIGNsZWFyQXV0aENhbGxiYWNrU3RhdGUocmVzcG9uc2UpO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIm5vcm1hbGl6ZVJldHVyblRvIiwiY2xlYXJBdXRoQ2FsbGJhY2tTdGF0ZSIsInJlYWRBdXRoQ2FsbGJhY2tTdGF0ZSIsIlNFU1NJT05fQ09PS0lFX05BTUUiLCJTRVNTSU9OX0RVUkFUSU9OX01JTlVURVMiLCJzZXNzaW9uQ29va2llT3B0aW9ucyIsImdldFN0eXRjaENsaWVudCIsImNyZWF0ZVJlcXVlc3RMb2dnZXIiLCJlbWFpbFRvTG9nTWV0YSIsInNlcmlhbGl6ZUVycm9yIiwiU1VCU0NSSUJFRF9DT09LSUVfTkFNRSIsInN1YnNjcmliZVRvQnV0dG9uZG93biIsInN1YnNjcmliZWRDb29raWVPcHRpb25zIiwicnVudGltZSIsImlzTWFnaWNMaW5rVG9rZW4iLCJ0b2tlblR5cGUiLCJsb2dpbkVycm9yUmVkaXJlY3QiLCJyZXF1ZXN0IiwiY29kZSIsInVybCIsIlVSTCIsInNlYXJjaFBhcmFtcyIsInNldCIsInJlZGlyZWN0IiwiR0VUIiwidG9rZW4iLCJnZXQiLCJxdWVyeVJldHVyblRvIiwicXVlcnlTdWJzY3JpYmUiLCJjYWxsYmFja1N0YXRlIiwiY29va2llUmV0dXJuVG8iLCJyZXR1cm5UbyIsInNob3VsZFN1YnNjcmliZSIsInN1YnNjcmliZSIsImxvZ2dlciIsInNjb3BlIiwiaW5mbyIsImhhc1Rva2VuIiwiQm9vbGVhbiIsIndhcm4iLCJyZXNwb25zZSIsImNsaWVudCIsInJlc3VsdCIsIm1hZ2ljTGlua3MiLCJhdXRoZW50aWNhdGUiLCJzZXNzaW9uX2R1cmF0aW9uX21pbnV0ZXMiLCJ1c2VySWQiLCJ1c2VyIiwidXNlcl9pZCIsImhhc1Nlc3Npb24iLCJzZXNzaW9uX3Rva2VuIiwiZGVzdGluYXRpb24iLCJjb29raWVzIiwicHJpbWFyeUVtYWlsIiwiZW1haWxzIiwiZmluZCIsImVtYWlsIiwidmVyaWZpZWQiLCJlbWFpbE1ldGEiLCJvcmlnaW4iLCJwcm9jZXNzIiwiZW52IiwiQVBQX09SSUdJTiIsInN1YnNjcmliZVJlc3VsdCIsImNoaWxkIiwic3RhdHVzIiwiZXJyb3IiLCJtYXhBZ2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/callback/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/callback-state.ts":
/*!************************************!*\
  !*** ./lib/auth/callback-state.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clearAuthCallbackState: () => (/* binding */ clearAuthCallbackState),\n/* harmony export */   persistAuthCallbackState: () => (/* binding */ persistAuthCallbackState),\n/* harmony export */   readAuthCallbackState: () => (/* binding */ readAuthCallbackState)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(rsc)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n\nconst AUTH_CALLBACK_RETURN_TO_COOKIE = \"msai_auth_return_to\";\nconst AUTH_CALLBACK_SUBSCRIBE_COOKIE = \"msai_auth_subscribe\";\nconst AUTH_CALLBACK_STATE_MAX_AGE_SECONDS = 60 * 10;\nconst authCallbackCookieOptions = {\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: \"development\" === \"production\",\n    path: \"/\",\n    maxAge: AUTH_CALLBACK_STATE_MAX_AGE_SECONDS\n};\nconst clearAuthCallbackCookieOptions = {\n    ...authCallbackCookieOptions,\n    maxAge: 0\n};\nconst encodeCookieValue = (value)=>encodeURIComponent(value);\nconst decodeCookieValue = (value)=>{\n    try {\n        return decodeURIComponent(value);\n    } catch  {\n        return value;\n    }\n};\nconst persistAuthCallbackState = (response, state)=>{\n    if (state.returnTo) {\n        response.cookies.set(AUTH_CALLBACK_RETURN_TO_COOKIE, encodeCookieValue(state.returnTo), authCallbackCookieOptions);\n    } else {\n        response.cookies.set(AUTH_CALLBACK_RETURN_TO_COOKIE, \"\", clearAuthCallbackCookieOptions);\n    }\n    response.cookies.set(AUTH_CALLBACK_SUBSCRIBE_COOKIE, state.subscribe ? \"1\" : \"0\", authCallbackCookieOptions);\n};\nconst readAuthCallbackState = (request)=>{\n    const rawReturnTo = request.cookies.get(AUTH_CALLBACK_RETURN_TO_COOKIE)?.value ?? null;\n    const rawSubscribe = request.cookies.get(AUTH_CALLBACK_SUBSCRIBE_COOKIE)?.value ?? null;\n    const returnTo = rawReturnTo ? decodeCookieValue(rawReturnTo) : null;\n    const subscribe = rawSubscribe ? rawSubscribe !== \"0\" : true;\n    return {\n        returnTo,\n        subscribe\n    };\n};\nconst clearAuthCallbackState = (response)=>{\n    response.cookies.set(AUTH_CALLBACK_RETURN_TO_COOKIE, \"\", clearAuthCallbackCookieOptions);\n    response.cookies.set(AUTH_CALLBACK_SUBSCRIBE_COOKIE, \"\", clearAuthCallbackCookieOptions);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9jYWxsYmFjay1zdGF0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFxQjtBQVdyQixNQUFNQSxpQ0FBaUM7QUFDdkMsTUFBTUMsaUNBQWlDO0FBQ3ZDLE1BQU1DLHNDQUFzQyxLQUFLO0FBRWpELE1BQU1DLDRCQUE0QjtJQUNoQ0MsVUFBVTtJQUNWQyxVQUFVO0lBQ1ZDLFFBQVFDLGtCQUF5QjtJQUNqQ0MsTUFBTTtJQUNOQyxRQUFRUDtBQUNWO0FBRUEsTUFBTVEsaUNBQWlDO0lBQ3JDLEdBQUdQLHlCQUF5QjtJQUM1Qk0sUUFBUTtBQUNWO0FBRUEsTUFBTUUsb0JBQW9CLENBQUNDLFFBQWtCQyxtQkFBbUJEO0FBQ2hFLE1BQU1FLG9CQUFvQixDQUFDRjtJQUN6QixJQUFJO1FBQ0YsT0FBT0csbUJBQW1CSDtJQUM1QixFQUFFLE9BQU07UUFDTixPQUFPQTtJQUNUO0FBQ0Y7QUFFTyxNQUFNSSwyQkFBMkIsQ0FDdENDLFVBQ0FDO0lBRUEsSUFBSUEsTUFBTUMsUUFBUSxFQUFFO1FBQ2xCRixTQUFTRyxPQUFPLENBQUNDLEdBQUcsQ0FDbEJyQixnQ0FDQVcsa0JBQWtCTyxNQUFNQyxRQUFRLEdBQ2hDaEI7SUFFSixPQUFPO1FBQ0xjLFNBQVNHLE9BQU8sQ0FBQ0MsR0FBRyxDQUNsQnJCLGdDQUNBLElBQ0FVO0lBRUo7SUFFQU8sU0FBU0csT0FBTyxDQUFDQyxHQUFHLENBQ2xCcEIsZ0NBQ0FpQixNQUFNSSxTQUFTLEdBQUcsTUFBTSxLQUN4Qm5CO0FBRUosRUFBRTtBQUVLLE1BQU1vQix3QkFBd0IsQ0FBQ0M7SUFDcEMsTUFBTUMsY0FDSkQsUUFBUUosT0FBTyxDQUFDTSxHQUFHLENBQUMxQixpQ0FBaUNZLFNBQVM7SUFDaEUsTUFBTWUsZUFDSkgsUUFBUUosT0FBTyxDQUFDTSxHQUFHLENBQUN6QixpQ0FBaUNXLFNBQVM7SUFFaEUsTUFBTU8sV0FBV00sY0FBY1gsa0JBQWtCVyxlQUFlO0lBQ2hFLE1BQU1ILFlBQVlLLGVBQWVBLGlCQUFpQixNQUFNO0lBRXhELE9BQU87UUFBRVI7UUFBVUc7SUFBVTtBQUMvQixFQUFFO0FBRUssTUFBTU0seUJBQXlCLENBQUNYO0lBQ3JDQSxTQUFTRyxPQUFPLENBQUNDLEdBQUcsQ0FDbEJyQixnQ0FDQSxJQUNBVTtJQUVGTyxTQUFTRyxPQUFPLENBQUNDLEdBQUcsQ0FDbEJwQixnQ0FDQSxJQUNBUztBQUVKLEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yeWFucm9zenRvY3p5L0RldmVsb3BtZW50L21haW5zdHJlZXRhaS13ZWJzaXRlL2FwcHMvbWVtYmVycy9saWIvYXV0aC9jYWxsYmFjay1zdGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCJzZXJ2ZXItb25seVwiO1xuXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcblxuLy8gU3RvcmUgc2hvcnQtbGl2ZWQgYXV0aCBjb250ZXh0IGluIGNvb2tpZXMgdG8gYXZvaWQgU3R5dGNoIHJlZGlyZWN0IFVSTCBxdWVyeSB2YWxpZGF0aW9uLlxuZXhwb3J0IHR5cGUgQXV0aENhbGxiYWNrU3RhdGUgPSB7XG4gIHJldHVyblRvOiBzdHJpbmcgfCBudWxsO1xuICBzdWJzY3JpYmU6IGJvb2xlYW47XG59O1xuXG5jb25zdCBBVVRIX0NBTExCQUNLX1JFVFVSTl9UT19DT09LSUUgPSBcIm1zYWlfYXV0aF9yZXR1cm5fdG9cIjtcbmNvbnN0IEFVVEhfQ0FMTEJBQ0tfU1VCU0NSSUJFX0NPT0tJRSA9IFwibXNhaV9hdXRoX3N1YnNjcmliZVwiO1xuY29uc3QgQVVUSF9DQUxMQkFDS19TVEFURV9NQVhfQUdFX1NFQ09ORFMgPSA2MCAqIDEwO1xuXG5jb25zdCBhdXRoQ2FsbGJhY2tDb29raWVPcHRpb25zID0ge1xuICBodHRwT25seTogdHJ1ZSxcbiAgc2FtZVNpdGU6IFwibGF4XCIgYXMgY29uc3QsXG4gIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiLFxuICBwYXRoOiBcIi9cIixcbiAgbWF4QWdlOiBBVVRIX0NBTExCQUNLX1NUQVRFX01BWF9BR0VfU0VDT05EUyxcbn07XG5cbmNvbnN0IGNsZWFyQXV0aENhbGxiYWNrQ29va2llT3B0aW9ucyA9IHtcbiAgLi4uYXV0aENhbGxiYWNrQ29va2llT3B0aW9ucyxcbiAgbWF4QWdlOiAwLFxufTtcblxuY29uc3QgZW5jb2RlQ29va2llVmFsdWUgPSAodmFsdWU6IHN0cmluZykgPT4gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbmNvbnN0IGRlY29kZUNvb2tpZVZhbHVlID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcGVyc2lzdEF1dGhDYWxsYmFja1N0YXRlID0gKFxuICByZXNwb25zZTogTmV4dFJlc3BvbnNlLFxuICBzdGF0ZTogQXV0aENhbGxiYWNrU3RhdGUsXG4pID0+IHtcbiAgaWYgKHN0YXRlLnJldHVyblRvKSB7XG4gICAgcmVzcG9uc2UuY29va2llcy5zZXQoXG4gICAgICBBVVRIX0NBTExCQUNLX1JFVFVSTl9UT19DT09LSUUsXG4gICAgICBlbmNvZGVDb29raWVWYWx1ZShzdGF0ZS5yZXR1cm5UbyksXG4gICAgICBhdXRoQ2FsbGJhY2tDb29raWVPcHRpb25zLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgcmVzcG9uc2UuY29va2llcy5zZXQoXG4gICAgICBBVVRIX0NBTExCQUNLX1JFVFVSTl9UT19DT09LSUUsXG4gICAgICBcIlwiLFxuICAgICAgY2xlYXJBdXRoQ2FsbGJhY2tDb29raWVPcHRpb25zLFxuICAgICk7XG4gIH1cblxuICByZXNwb25zZS5jb29raWVzLnNldChcbiAgICBBVVRIX0NBTExCQUNLX1NVQlNDUklCRV9DT09LSUUsXG4gICAgc3RhdGUuc3Vic2NyaWJlID8gXCIxXCIgOiBcIjBcIixcbiAgICBhdXRoQ2FsbGJhY2tDb29raWVPcHRpb25zLFxuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlYWRBdXRoQ2FsbGJhY2tTdGF0ZSA9IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IEF1dGhDYWxsYmFja1N0YXRlID0+IHtcbiAgY29uc3QgcmF3UmV0dXJuVG8gPVxuICAgIHJlcXVlc3QuY29va2llcy5nZXQoQVVUSF9DQUxMQkFDS19SRVRVUk5fVE9fQ09PS0lFKT8udmFsdWUgPz8gbnVsbDtcbiAgY29uc3QgcmF3U3Vic2NyaWJlID1cbiAgICByZXF1ZXN0LmNvb2tpZXMuZ2V0KEFVVEhfQ0FMTEJBQ0tfU1VCU0NSSUJFX0NPT0tJRSk/LnZhbHVlID8/IG51bGw7XG5cbiAgY29uc3QgcmV0dXJuVG8gPSByYXdSZXR1cm5UbyA/IGRlY29kZUNvb2tpZVZhbHVlKHJhd1JldHVyblRvKSA6IG51bGw7XG4gIGNvbnN0IHN1YnNjcmliZSA9IHJhd1N1YnNjcmliZSA/IHJhd1N1YnNjcmliZSAhPT0gXCIwXCIgOiB0cnVlO1xuXG4gIHJldHVybiB7IHJldHVyblRvLCBzdWJzY3JpYmUgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBjbGVhckF1dGhDYWxsYmFja1N0YXRlID0gKHJlc3BvbnNlOiBOZXh0UmVzcG9uc2UpID0+IHtcbiAgcmVzcG9uc2UuY29va2llcy5zZXQoXG4gICAgQVVUSF9DQUxMQkFDS19SRVRVUk5fVE9fQ09PS0lFLFxuICAgIFwiXCIsXG4gICAgY2xlYXJBdXRoQ2FsbGJhY2tDb29raWVPcHRpb25zLFxuICApO1xuICByZXNwb25zZS5jb29raWVzLnNldChcbiAgICBBVVRIX0NBTExCQUNLX1NVQlNDUklCRV9DT09LSUUsXG4gICAgXCJcIixcbiAgICBjbGVhckF1dGhDYWxsYmFja0Nvb2tpZU9wdGlvbnMsXG4gICk7XG59O1xuIl0sIm5hbWVzIjpbIkFVVEhfQ0FMTEJBQ0tfUkVUVVJOX1RPX0NPT0tJRSIsIkFVVEhfQ0FMTEJBQ0tfU1VCU0NSSUJFX0NPT0tJRSIsIkFVVEhfQ0FMTEJBQ0tfU1RBVEVfTUFYX0FHRV9TRUNPTkRTIiwiYXV0aENhbGxiYWNrQ29va2llT3B0aW9ucyIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJzZWN1cmUiLCJwcm9jZXNzIiwicGF0aCIsIm1heEFnZSIsImNsZWFyQXV0aENhbGxiYWNrQ29va2llT3B0aW9ucyIsImVuY29kZUNvb2tpZVZhbHVlIiwidmFsdWUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkZWNvZGVDb29raWVWYWx1ZSIsImRlY29kZVVSSUNvbXBvbmVudCIsInBlcnNpc3RBdXRoQ2FsbGJhY2tTdGF0ZSIsInJlc3BvbnNlIiwic3RhdGUiLCJyZXR1cm5UbyIsImNvb2tpZXMiLCJzZXQiLCJzdWJzY3JpYmUiLCJyZWFkQXV0aENhbGxiYWNrU3RhdGUiLCJyZXF1ZXN0IiwicmF3UmV0dXJuVG8iLCJnZXQiLCJyYXdTdWJzY3JpYmUiLCJjbGVhckF1dGhDYWxsYmFja1N0YXRlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/callback-state.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/return-to.ts":
/*!*******************************!*\
  !*** ./lib/auth/return-to.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizeReturnTo: () => (/* binding */ normalizeReturnTo)\n/* harmony export */ });\n// Allow only in-app relative paths to avoid open redirects.\nconst normalizeReturnTo = (value)=>{\n    if (!value) {\n        return null;\n    }\n    const trimmed = value.trim();\n    if (!trimmed.startsWith(\"/\")) {\n        return null;\n    }\n    if (trimmed.startsWith(\"//\") || trimmed.includes(\"://\")) {\n        return null;\n    }\n    return trimmed;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9yZXR1cm4tdG8udHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLDREQUE0RDtBQUNyRCxNQUFNQSxvQkFBb0IsQ0FDL0JDO0lBRUEsSUFBSSxDQUFDQSxPQUFPO1FBQ1YsT0FBTztJQUNUO0lBRUEsTUFBTUMsVUFBVUQsTUFBTUUsSUFBSTtJQUMxQixJQUFJLENBQUNELFFBQVFFLFVBQVUsQ0FBQyxNQUFNO1FBQzVCLE9BQU87SUFDVDtJQUVBLElBQUlGLFFBQVFFLFVBQVUsQ0FBQyxTQUFTRixRQUFRRyxRQUFRLENBQUMsUUFBUTtRQUN2RCxPQUFPO0lBQ1Q7SUFFQSxPQUFPSDtBQUNULEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yeWFucm9zenRvY3p5L0RldmVsb3BtZW50L21haW5zdHJlZXRhaS13ZWJzaXRlL2FwcHMvbWVtYmVycy9saWIvYXV0aC9yZXR1cm4tdG8udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQWxsb3cgb25seSBpbi1hcHAgcmVsYXRpdmUgcGF0aHMgdG8gYXZvaWQgb3BlbiByZWRpcmVjdHMuXG5leHBvcnQgY29uc3Qgbm9ybWFsaXplUmV0dXJuVG8gPSAoXG4gIHZhbHVlPzogc3RyaW5nIHwgbnVsbCxcbik6IHN0cmluZyB8IG51bGwgPT4ge1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCB0cmltbWVkID0gdmFsdWUudHJpbSgpO1xuICBpZiAoIXRyaW1tZWQuc3RhcnRzV2l0aChcIi9cIikpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICh0cmltbWVkLnN0YXJ0c1dpdGgoXCIvL1wiKSB8fCB0cmltbWVkLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gdHJpbW1lZDtcbn07XG4iXSwibmFtZXMiOlsibm9ybWFsaXplUmV0dXJuVG8iLCJ2YWx1ZSIsInRyaW1tZWQiLCJ0cmltIiwic3RhcnRzV2l0aCIsImluY2x1ZGVzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/return-to.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/session.ts":
/*!*****************************!*\
  !*** ./lib/auth/session.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SESSION_COOKIE_NAME: () => (/* binding */ SESSION_COOKIE_NAME),\n/* harmony export */   SESSION_DURATION_MINUTES: () => (/* binding */ SESSION_DURATION_MINUTES),\n/* harmony export */   SESSION_MAX_AGE_SECONDS: () => (/* binding */ SESSION_MAX_AGE_SECONDS),\n/* harmony export */   authenticateSessionToken: () => (/* binding */ authenticateSessionToken),\n/* harmony export */   getSession: () => (/* binding */ getSession),\n/* harmony export */   requireSession: () => (/* binding */ requireSession),\n/* harmony export */   sessionCookieOptions: () => (/* binding */ sessionCookieOptions)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var next_navigation__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/navigation */ \"(rsc)/./node_modules/next/dist/api/navigation.react-server.js\");\n/* harmony import */ var _return_to__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./return-to */ \"(rsc)/./lib/auth/return-to.ts\");\n/* harmony import */ var _stytch__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stytch */ \"(rsc)/./lib/auth/stytch.ts\");\n/* harmony import */ var _lib_logging_server__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/logging/server */ \"(rsc)/./lib/logging/server.ts\");\n\n\n\n\n\nconst SESSION_COOKIE_NAME = process.env.SESSION_COOKIE_NAME ?? \"msai_session\";\nconst SESSION_MAX_AGE_SECONDS = 60 * 60 * 24 * 30;\nconst SESSION_DURATION_MINUTES = 60 * 24 * 30;\n// Host-only cookie, SameSite=Lax, 30-day TTL, Stytch-managed session token.\nconst sessionCookieOptions = {\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: \"development\" === \"production\",\n    path: \"/\",\n    maxAge: SESSION_MAX_AGE_SECONDS\n};\nconst logger = (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_4__.createLogger)({\n    scope: \"auth.session\"\n});\nconst getPrimaryEmail = (user)=>{\n    const verified = user.emails.find((email)=>email.verified);\n    return (verified ?? user.emails[0])?.email ?? null;\n};\nconst authenticateSessionToken = async (sessionToken)=>{\n    const client = (0,_stytch__WEBPACK_IMPORTED_MODULE_3__.getStytchClient)();\n    const result = await client.sessions.authenticate({\n        session_token: sessionToken\n    });\n    return {\n        user: result.user,\n        session: result.session,\n        sessionToken,\n        primaryEmail: getPrimaryEmail(result.user)\n    };\n};\nconst readSessionToken = async (request)=>{\n    if (request) {\n        return request.cookies.get(SESSION_COOKIE_NAME)?.value ?? null;\n    }\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    return cookieStore.get(SESSION_COOKIE_NAME)?.value ?? null;\n};\nconst getSession = async (request)=>{\n    const token = await readSessionToken(request);\n    if (!token) {\n        return null;\n    }\n    try {\n        return await authenticateSessionToken(token);\n    } catch (error) {\n        logger.debug(\"auth.session.authenticate_failed\", {\n            error: (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_4__.serializeError)(error)\n        });\n        return null;\n    }\n};\nconst requireSession = async (returnTo)=>{\n    const session = await getSession();\n    if (!session) {\n        const safeReturnTo = (0,_return_to__WEBPACK_IMPORTED_MODULE_2__.normalizeReturnTo)(returnTo);\n        const loginUrl = safeReturnTo ? `/login?returnTo=${encodeURIComponent(safeReturnTo)}` : \"/login\";\n        (0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.redirect)(loginUrl);\n    }\n    return session;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9zZXNzaW9uLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUN1QztBQUNJO0FBR0s7QUFDTDtBQUN5QjtBQUU3RCxNQUFNTSxzQkFDWEMsUUFBUUMsR0FBRyxDQUFDRixtQkFBbUIsSUFBSSxlQUFlO0FBQzdDLE1BQU1HLDBCQUEwQixLQUFLLEtBQUssS0FBSyxHQUFHO0FBQ2xELE1BQU1DLDJCQUEyQixLQUFLLEtBQUssR0FBRztBQUVyRCw0RUFBNEU7QUFDckUsTUFBTUMsdUJBQXVCO0lBQ2xDQyxVQUFVO0lBQ1ZDLFVBQVU7SUFDVkMsUUFBUVAsa0JBQXlCO0lBQ2pDUSxNQUFNO0lBQ05DLFFBQVFQO0FBQ1YsRUFBRTtBQVNGLE1BQU1RLFNBQVNiLGlFQUFZQSxDQUFDO0lBQUVjLE9BQU87QUFBZTtBQUVwRCxNQUFNQyxrQkFBa0IsQ0FBQ0M7SUFDdkIsTUFBTUMsV0FBV0QsS0FBS0UsTUFBTSxDQUFDQyxJQUFJLENBQUMsQ0FBQ0MsUUFBVUEsTUFBTUgsUUFBUTtJQUMzRCxPQUFPLENBQUNBLFlBQVlELEtBQUtFLE1BQU0sQ0FBQyxFQUFFLEdBQUdFLFNBQVM7QUFDaEQ7QUFFTyxNQUFNQywyQkFBMkIsT0FDdENDO0lBRUEsTUFBTUMsU0FBU3hCLHdEQUFlQTtJQUM5QixNQUFNeUIsU0FBUyxNQUFNRCxPQUFPRSxRQUFRLENBQUNDLFlBQVksQ0FBQztRQUNoREMsZUFBZUw7SUFDakI7SUFFQSxPQUFPO1FBQ0xOLE1BQU1RLE9BQU9SLElBQUk7UUFDakJZLFNBQVNKLE9BQU9JLE9BQU87UUFDdkJOO1FBQ0FPLGNBQWNkLGdCQUFnQlMsT0FBT1IsSUFBSTtJQUMzQztBQUNGLEVBQUU7QUFFRixNQUFNYyxtQkFBbUIsT0FBT0M7SUFDOUIsSUFBSUEsU0FBUztRQUNYLE9BQU9BLFFBQVFuQyxPQUFPLENBQUNvQyxHQUFHLENBQUM5QixzQkFBc0IrQixTQUFTO0lBQzVEO0lBRUEsTUFBTUMsY0FBYyxNQUFNdEMscURBQU9BO0lBQ2pDLE9BQU9zQyxZQUFZRixHQUFHLENBQUM5QixzQkFBc0IrQixTQUFTO0FBQ3hEO0FBRU8sTUFBTUUsYUFBYSxPQUN4Qko7SUFFQSxNQUFNSyxRQUFRLE1BQU1OLGlCQUFpQkM7SUFDckMsSUFBSSxDQUFDSyxPQUFPO1FBQ1YsT0FBTztJQUNUO0lBRUEsSUFBSTtRQUNGLE9BQU8sTUFBTWYseUJBQXlCZTtJQUN4QyxFQUFFLE9BQU9DLE9BQU87UUFDZHhCLE9BQU95QixLQUFLLENBQUMsb0NBQW9DO1lBQy9DRCxPQUFPcEMsbUVBQWNBLENBQUNvQztRQUN4QjtRQUNBLE9BQU87SUFDVDtBQUNGLEVBQUU7QUFFSyxNQUFNRSxpQkFBaUIsT0FDNUJDO0lBRUEsTUFBTVosVUFBVSxNQUFNTztJQUN0QixJQUFJLENBQUNQLFNBQVM7UUFDWixNQUFNYSxlQUFlM0MsNkRBQWlCQSxDQUFDMEM7UUFDdkMsTUFBTUUsV0FBV0QsZUFDYixDQUFDLGdCQUFnQixFQUFFRSxtQkFBbUJGLGVBQWUsR0FDckQ7UUFDSjVDLHlEQUFRQSxDQUFDNkM7SUFDWDtJQUVBLE9BQU9kO0FBQ1QsRUFBRSIsInNvdXJjZXMiOlsiL1VzZXJzL3J5YW5yb3N6dG9jenkvRGV2ZWxvcG1lbnQvbWFpbnN0cmVldGFpLXdlYnNpdGUvYXBwcy9tZW1iZXJzL2xpYi9hdXRoL3Nlc3Npb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBTZXNzaW9uLCBVc2VyIH0gZnJvbSBcInN0eXRjaFwiO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcbmltcG9ydCB7IHJlZGlyZWN0IH0gZnJvbSBcIm5leHQvbmF2aWdhdGlvblwiO1xuaW1wb3J0IHR5cGUgeyBOZXh0UmVxdWVzdCB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuXG5pbXBvcnQgeyBub3JtYWxpemVSZXR1cm5UbyB9IGZyb20gXCIuL3JldHVybi10b1wiO1xuaW1wb3J0IHsgZ2V0U3R5dGNoQ2xpZW50IH0gZnJvbSBcIi4vc3R5dGNoXCI7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIsIHNlcmlhbGl6ZUVycm9yIH0gZnJvbSBcIkAvbGliL2xvZ2dpbmcvc2VydmVyXCI7XG5cbmV4cG9ydCBjb25zdCBTRVNTSU9OX0NPT0tJRV9OQU1FID1cbiAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9DT09LSUVfTkFNRSA/PyBcIm1zYWlfc2Vzc2lvblwiO1xuZXhwb3J0IGNvbnN0IFNFU1NJT05fTUFYX0FHRV9TRUNPTkRTID0gNjAgKiA2MCAqIDI0ICogMzA7XG5leHBvcnQgY29uc3QgU0VTU0lPTl9EVVJBVElPTl9NSU5VVEVTID0gNjAgKiAyNCAqIDMwO1xuXG4vLyBIb3N0LW9ubHkgY29va2llLCBTYW1lU2l0ZT1MYXgsIDMwLWRheSBUVEwsIFN0eXRjaC1tYW5hZ2VkIHNlc3Npb24gdG9rZW4uXG5leHBvcnQgY29uc3Qgc2Vzc2lvbkNvb2tpZU9wdGlvbnMgPSB7XG4gIGh0dHBPbmx5OiB0cnVlLFxuICBzYW1lU2l0ZTogXCJsYXhcIiBhcyBjb25zdCxcbiAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIsXG4gIHBhdGg6IFwiL1wiLFxuICBtYXhBZ2U6IFNFU1NJT05fTUFYX0FHRV9TRUNPTkRTLFxufTtcblxuZXhwb3J0IHR5cGUgU2Vzc2lvbkluZm8gPSB7XG4gIHVzZXI6IFVzZXI7XG4gIHNlc3Npb24/OiBTZXNzaW9uO1xuICBzZXNzaW9uVG9rZW46IHN0cmluZztcbiAgcHJpbWFyeUVtYWlsOiBzdHJpbmcgfCBudWxsO1xufTtcblxuY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKHsgc2NvcGU6IFwiYXV0aC5zZXNzaW9uXCIgfSk7XG5cbmNvbnN0IGdldFByaW1hcnlFbWFpbCA9ICh1c2VyOiBVc2VyKSA9PiB7XG4gIGNvbnN0IHZlcmlmaWVkID0gdXNlci5lbWFpbHMuZmluZCgoZW1haWwpID0+IGVtYWlsLnZlcmlmaWVkKTtcbiAgcmV0dXJuICh2ZXJpZmllZCA/PyB1c2VyLmVtYWlsc1swXSk/LmVtYWlsID8/IG51bGw7XG59O1xuXG5leHBvcnQgY29uc3QgYXV0aGVudGljYXRlU2Vzc2lvblRva2VuID0gYXN5bmMgKFxuICBzZXNzaW9uVG9rZW46IHN0cmluZyxcbik6IFByb21pc2U8U2Vzc2lvbkluZm8+ID0+IHtcbiAgY29uc3QgY2xpZW50ID0gZ2V0U3R5dGNoQ2xpZW50KCk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5zZXNzaW9ucy5hdXRoZW50aWNhdGUoe1xuICAgIHNlc3Npb25fdG9rZW46IHNlc3Npb25Ub2tlbixcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICB1c2VyOiByZXN1bHQudXNlcixcbiAgICBzZXNzaW9uOiByZXN1bHQuc2Vzc2lvbixcbiAgICBzZXNzaW9uVG9rZW4sXG4gICAgcHJpbWFyeUVtYWlsOiBnZXRQcmltYXJ5RW1haWwocmVzdWx0LnVzZXIpLFxuICB9O1xufTtcblxuY29uc3QgcmVhZFNlc3Npb25Ub2tlbiA9IGFzeW5jIChyZXF1ZXN0PzogTmV4dFJlcXVlc3QpID0+IHtcbiAgaWYgKHJlcXVlc3QpIHtcbiAgICByZXR1cm4gcmVxdWVzdC5jb29raWVzLmdldChTRVNTSU9OX0NPT0tJRV9OQU1FKT8udmFsdWUgPz8gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuICByZXR1cm4gY29va2llU3RvcmUuZ2V0KFNFU1NJT05fQ09PS0lFX05BTUUpPy52YWx1ZSA/PyBudWxsO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFNlc3Npb24gPSBhc3luYyAoXG4gIHJlcXVlc3Q/OiBOZXh0UmVxdWVzdCxcbik6IFByb21pc2U8U2Vzc2lvbkluZm8gfCBudWxsPiA9PiB7XG4gIGNvbnN0IHRva2VuID0gYXdhaXQgcmVhZFNlc3Npb25Ub2tlbihyZXF1ZXN0KTtcbiAgaWYgKCF0b2tlbikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgYXV0aGVudGljYXRlU2Vzc2lvblRva2VuKHRva2VuKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZGVidWcoXCJhdXRoLnNlc3Npb24uYXV0aGVudGljYXRlX2ZhaWxlZFwiLCB7XG4gICAgICBlcnJvcjogc2VyaWFsaXplRXJyb3IoZXJyb3IpLFxuICAgIH0pO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcmVxdWlyZVNlc3Npb24gPSBhc3luYyAoXG4gIHJldHVyblRvPzogc3RyaW5nLFxuKTogUHJvbWlzZTxTZXNzaW9uSW5mbz4gPT4ge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbigpO1xuICBpZiAoIXNlc3Npb24pIHtcbiAgICBjb25zdCBzYWZlUmV0dXJuVG8gPSBub3JtYWxpemVSZXR1cm5UbyhyZXR1cm5Ubyk7XG4gICAgY29uc3QgbG9naW5VcmwgPSBzYWZlUmV0dXJuVG9cbiAgICAgID8gYC9sb2dpbj9yZXR1cm5Ubz0ke2VuY29kZVVSSUNvbXBvbmVudChzYWZlUmV0dXJuVG8pfWBcbiAgICAgIDogXCIvbG9naW5cIjtcbiAgICByZWRpcmVjdChsb2dpblVybCk7XG4gIH1cblxuICByZXR1cm4gc2Vzc2lvbjtcbn07XG4iXSwibmFtZXMiOlsiY29va2llcyIsInJlZGlyZWN0Iiwibm9ybWFsaXplUmV0dXJuVG8iLCJnZXRTdHl0Y2hDbGllbnQiLCJjcmVhdGVMb2dnZXIiLCJzZXJpYWxpemVFcnJvciIsIlNFU1NJT05fQ09PS0lFX05BTUUiLCJwcm9jZXNzIiwiZW52IiwiU0VTU0lPTl9NQVhfQUdFX1NFQ09ORFMiLCJTRVNTSU9OX0RVUkFUSU9OX01JTlVURVMiLCJzZXNzaW9uQ29va2llT3B0aW9ucyIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJzZWN1cmUiLCJwYXRoIiwibWF4QWdlIiwibG9nZ2VyIiwic2NvcGUiLCJnZXRQcmltYXJ5RW1haWwiLCJ1c2VyIiwidmVyaWZpZWQiLCJlbWFpbHMiLCJmaW5kIiwiZW1haWwiLCJhdXRoZW50aWNhdGVTZXNzaW9uVG9rZW4iLCJzZXNzaW9uVG9rZW4iLCJjbGllbnQiLCJyZXN1bHQiLCJzZXNzaW9ucyIsImF1dGhlbnRpY2F0ZSIsInNlc3Npb25fdG9rZW4iLCJzZXNzaW9uIiwicHJpbWFyeUVtYWlsIiwicmVhZFNlc3Npb25Ub2tlbiIsInJlcXVlc3QiLCJnZXQiLCJ2YWx1ZSIsImNvb2tpZVN0b3JlIiwiZ2V0U2Vzc2lvbiIsInRva2VuIiwiZXJyb3IiLCJkZWJ1ZyIsInJlcXVpcmVTZXNzaW9uIiwicmV0dXJuVG8iLCJzYWZlUmV0dXJuVG8iLCJsb2dpblVybCIsImVuY29kZVVSSUNvbXBvbmVudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/session.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/stytch.ts":
/*!****************************!*\
  !*** ./lib/auth/stytch.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getStytchClient: () => (/* binding */ getStytchClient)\n/* harmony export */ });\n/* harmony import */ var stytch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stytch */ \"(rsc)/./node_modules/stytch/dist/index.js\");\n/* harmony import */ var stytch__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(stytch__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_logging_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logging/server */ \"(rsc)/./lib/logging/server.ts\");\n\n\nconst logger = (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_1__.createLogger)({\n    scope: \"auth.stytch\"\n});\nconst requiredEnv = (key)=>{\n    const value = process.env[key];\n    if (!value) {\n        logger.error(\"auth.stytch.missing_env\", {\n            key\n        });\n        throw new Error(`Missing required env var: ${key}`);\n    }\n    return value;\n};\nconst resolveStytchEnv = ()=>{\n    const env = (process.env.STYTCH_ENV ?? \"test\").toLowerCase();\n    return env === \"live\" ? stytch__WEBPACK_IMPORTED_MODULE_0__.envs.live : stytch__WEBPACK_IMPORTED_MODULE_0__.envs.test;\n};\nlet stytchClient = null;\nconst getStytchClient = ()=>{\n    if (!stytchClient) {\n        const env = resolveStytchEnv();\n        stytchClient = new stytch__WEBPACK_IMPORTED_MODULE_0__.Client({\n            project_id: requiredEnv(\"STYTCH_PROJECT_ID\"),\n            secret: requiredEnv(\"STYTCH_SECRET\"),\n            env\n        });\n        logger.info(\"auth.stytch.client_initialized\", {\n            env: env === stytch__WEBPACK_IMPORTED_MODULE_0__.envs.live ? \"live\" : \"test\"\n        });\n    }\n    return stytchClient;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9zdHl0Y2gudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFzQztBQUVjO0FBRXBELE1BQU1HLFNBQVNELGlFQUFZQSxDQUFDO0lBQUVFLE9BQU87QUFBYztBQUVuRCxNQUFNQyxjQUFjLENBQUNDO0lBQ25CLE1BQU1DLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0gsSUFBSTtJQUM5QixJQUFJLENBQUNDLE9BQU87UUFDVkosT0FBT08sS0FBSyxDQUFDLDJCQUEyQjtZQUFFSjtRQUFJO1FBQzlDLE1BQU0sSUFBSUssTUFBTSxDQUFDLDBCQUEwQixFQUFFTCxLQUFLO0lBQ3BEO0lBQ0EsT0FBT0M7QUFDVDtBQUVBLE1BQU1LLG1CQUFtQjtJQUN2QixNQUFNSCxNQUFNLENBQUNELFFBQVFDLEdBQUcsQ0FBQ0ksVUFBVSxJQUFJLE1BQUssRUFBR0MsV0FBVztJQUMxRCxPQUFPTCxRQUFRLFNBQVNSLHdDQUFJQSxDQUFDYyxJQUFJLEdBQUdkLHdDQUFJQSxDQUFDZSxJQUFJO0FBQy9DO0FBRUEsSUFBSUMsZUFBOEI7QUFFM0IsTUFBTUMsa0JBQWtCO0lBQzdCLElBQUksQ0FBQ0QsY0FBYztRQUNqQixNQUFNUixNQUFNRztRQUNaSyxlQUFlLElBQUlqQiwwQ0FBTUEsQ0FBQztZQUN4Qm1CLFlBQVlkLFlBQVk7WUFDeEJlLFFBQVFmLFlBQVk7WUFDcEJJO1FBQ0Y7UUFDQU4sT0FBT2tCLElBQUksQ0FBQyxrQ0FBa0M7WUFDNUNaLEtBQUtBLFFBQVFSLHdDQUFJQSxDQUFDYyxJQUFJLEdBQUcsU0FBUztRQUNwQztJQUNGO0lBQ0EsT0FBT0U7QUFDVCxFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvcnlhbnJvc3p0b2N6eS9EZXZlbG9wbWVudC9tYWluc3RyZWV0YWktd2Vic2l0ZS9hcHBzL21lbWJlcnMvbGliL2F1dGgvc3R5dGNoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENsaWVudCwgZW52cyB9IGZyb20gXCJzdHl0Y2hcIjtcblxuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSBcIkAvbGliL2xvZ2dpbmcvc2VydmVyXCI7XG5cbmNvbnN0IGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcih7IHNjb3BlOiBcImF1dGguc3R5dGNoXCIgfSk7XG5cbmNvbnN0IHJlcXVpcmVkRW52ID0gKGtleTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHZhbHVlID0gcHJvY2Vzcy5lbnZba2V5XTtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIGxvZ2dlci5lcnJvcihcImF1dGguc3R5dGNoLm1pc3NpbmdfZW52XCIsIHsga2V5IH0pO1xuICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyByZXF1aXJlZCBlbnYgdmFyOiAke2tleX1gKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59O1xuXG5jb25zdCByZXNvbHZlU3R5dGNoRW52ID0gKCkgPT4ge1xuICBjb25zdCBlbnYgPSAocHJvY2Vzcy5lbnYuU1RZVENIX0VOViA/PyBcInRlc3RcIikudG9Mb3dlckNhc2UoKTtcbiAgcmV0dXJuIGVudiA9PT0gXCJsaXZlXCIgPyBlbnZzLmxpdmUgOiBlbnZzLnRlc3Q7XG59O1xuXG5sZXQgc3R5dGNoQ2xpZW50OiBDbGllbnQgfCBudWxsID0gbnVsbDtcblxuZXhwb3J0IGNvbnN0IGdldFN0eXRjaENsaWVudCA9ICgpID0+IHtcbiAgaWYgKCFzdHl0Y2hDbGllbnQpIHtcbiAgICBjb25zdCBlbnYgPSByZXNvbHZlU3R5dGNoRW52KCk7XG4gICAgc3R5dGNoQ2xpZW50ID0gbmV3IENsaWVudCh7XG4gICAgICBwcm9qZWN0X2lkOiByZXF1aXJlZEVudihcIlNUWVRDSF9QUk9KRUNUX0lEXCIpLFxuICAgICAgc2VjcmV0OiByZXF1aXJlZEVudihcIlNUWVRDSF9TRUNSRVRcIiksXG4gICAgICBlbnYsXG4gICAgfSk7XG4gICAgbG9nZ2VyLmluZm8oXCJhdXRoLnN0eXRjaC5jbGllbnRfaW5pdGlhbGl6ZWRcIiwge1xuICAgICAgZW52OiBlbnYgPT09IGVudnMubGl2ZSA/IFwibGl2ZVwiIDogXCJ0ZXN0XCIsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHN0eXRjaENsaWVudDtcbn07XG4iXSwibmFtZXMiOlsiQ2xpZW50IiwiZW52cyIsImNyZWF0ZUxvZ2dlciIsImxvZ2dlciIsInNjb3BlIiwicmVxdWlyZWRFbnYiLCJrZXkiLCJ2YWx1ZSIsInByb2Nlc3MiLCJlbnYiLCJlcnJvciIsIkVycm9yIiwicmVzb2x2ZVN0eXRjaEVudiIsIlNUWVRDSF9FTlYiLCJ0b0xvd2VyQ2FzZSIsImxpdmUiLCJ0ZXN0Iiwic3R5dGNoQ2xpZW50IiwiZ2V0U3R5dGNoQ2xpZW50IiwicHJvamVjdF9pZCIsInNlY3JldCIsImluZm8iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/stytch.ts\n");

/***/ }),

/***/ "(rsc)/./lib/logging/server.ts":
/*!*******************************!*\
  !*** ./lib/logging/server.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createLogger: () => (/* binding */ createLogger),\n/* harmony export */   createRequestLogger: () => (/* binding */ createRequestLogger),\n/* harmony export */   emailToLogMeta: () => (/* binding */ emailToLogMeta),\n/* harmony export */   serializeError: () => (/* binding */ serializeError)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(rsc)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:crypto */ \"node:crypto\");\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_crypto__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst LOG_LEVELS = {\n    debug: 10,\n    info: 20,\n    warn: 30,\n    error: 40\n};\nconst DEFAULT_LOG_LEVEL =  false ? 0 : \"debug\";\nconst normalizeLogLevel = (value)=>{\n    if (!value) return DEFAULT_LOG_LEVEL;\n    const normalized = value.trim().toLowerCase();\n    if (normalized === \"warning\") return \"warn\";\n    if (normalized in LOG_LEVELS) return normalized;\n    return DEFAULT_LOG_LEVEL;\n};\nconst ACTIVE_LOG_LEVEL = normalizeLogLevel(process.env.LOG_LEVEL);\nconst LOG_PII = [\n    \"1\",\n    \"true\",\n    \"yes\",\n    \"on\"\n].includes((process.env.LOG_PII ?? \"\").toLowerCase());\nconst BASE_META = {\n    app: \"members\",\n    env: \"development\" ?? 0\n};\nconst shouldLog = (level)=>LOG_LEVELS[level] >= LOG_LEVELS[ACTIVE_LOG_LEVEL];\nconst writeLog = (level, message, meta)=>{\n    if (!shouldLog(level)) return;\n    const entry = {\n        ts: new Date().toISOString(),\n        level,\n        msg: message,\n        ...BASE_META,\n        ...meta ?? {}\n    };\n    let line = \"\";\n    try {\n        line = JSON.stringify(entry);\n    } catch  {\n        line = JSON.stringify({\n            ts: entry.ts,\n            level,\n            msg: message,\n            ...BASE_META,\n            error: \"log-serialization-failed\"\n        });\n    }\n    const sink = level === \"error\" ? console.error : level === \"warn\" ? console.warn : console.log;\n    sink(line);\n};\nconst createLogger = (baseMeta = {})=>{\n    const mergedBase = {\n        ...baseMeta\n    };\n    return {\n        debug: (message, meta)=>writeLog(\"debug\", message, {\n                ...mergedBase,\n                ...meta\n            }),\n        info: (message, meta)=>writeLog(\"info\", message, {\n                ...mergedBase,\n                ...meta\n            }),\n        warn: (message, meta)=>writeLog(\"warn\", message, {\n                ...mergedBase,\n                ...meta\n            }),\n        error: (message, meta)=>writeLog(\"error\", message, {\n                ...mergedBase,\n                ...meta\n            }),\n        child: (meta)=>createLogger({\n                ...mergedBase,\n                ...meta\n            })\n    };\n};\nconst requestIdFromHeaders = (headers)=>headers.get(\"x-request-id\") ?? headers.get(\"x-vercel-id\") ?? headers.get(\"x-amzn-trace-id\") ?? (0,node_crypto__WEBPACK_IMPORTED_MODULE_1__.randomUUID)();\nconst createRequestLogger = (request, baseMeta = {})=>{\n    const url = new URL(request.url);\n    return createLogger({\n        ...baseMeta,\n        requestId: requestIdFromHeaders(request.headers),\n        method: request.method,\n        path: url.pathname\n    });\n};\nconst emailToLogMeta = (email)=>{\n    const trimmed = email?.trim().toLowerCase();\n    if (!trimmed) return {};\n    if (LOG_PII) {\n        return {\n            email: trimmed\n        };\n    }\n    const [, domain = \"unknown\"] = trimmed.split(\"@\");\n    const emailHash = (0,node_crypto__WEBPACK_IMPORTED_MODULE_1__.createHash)(\"sha256\").update(trimmed).digest(\"hex\").slice(0, 12);\n    return {\n        emailHash,\n        emailDomain: domain\n    };\n};\nconst serializeError = (error)=>{\n    if (error instanceof Error) {\n        return {\n            name: error.name,\n            message: error.message,\n            stack: error.stack ?? \"\"\n        };\n    }\n    if (typeof error === \"string\") {\n        return {\n            message: error\n        };\n    }\n    try {\n        return {\n            message: JSON.stringify(error)\n        };\n    } catch  {\n        return {\n            message: String(error)\n        };\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvbG9nZ2luZy9zZXJ2ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBcUI7QUFFZ0M7QUFlckQsTUFBTUUsYUFBdUM7SUFDM0NDLE9BQU87SUFDUEMsTUFBTTtJQUNOQyxNQUFNO0lBQ05DLE9BQU87QUFDVDtBQUVBLE1BQU1DLG9CQUNKQyxNQUFxQyxHQUFHLENBQU0sR0FBRztBQUVuRCxNQUFNQyxvQkFBb0IsQ0FBQ0M7SUFDekIsSUFBSSxDQUFDQSxPQUFPLE9BQU9IO0lBQ25CLE1BQU1JLGFBQWFELE1BQU1FLElBQUksR0FBR0MsV0FBVztJQUMzQyxJQUFJRixlQUFlLFdBQVcsT0FBTztJQUNyQyxJQUFJQSxjQUFjVCxZQUFZLE9BQU9TO0lBQ3JDLE9BQU9KO0FBQ1Q7QUFFQSxNQUFNTyxtQkFBbUJMLGtCQUFrQkQsUUFBUU8sR0FBRyxDQUFDQyxTQUFTO0FBQ2hFLE1BQU1DLFVBQVU7SUFBQztJQUFLO0lBQVE7SUFBTztDQUFLLENBQUNDLFFBQVEsQ0FDakQsQ0FBQ1YsUUFBUU8sR0FBRyxDQUFDRSxPQUFPLElBQUksRUFBQyxFQUFHSixXQUFXO0FBR3pDLE1BQU1NLFlBQXFCO0lBQ3pCQyxLQUFLO0lBQ0xMLEtBQUtQLGlCQUF3QixDQUFhO0FBQzVDO0FBRUEsTUFBTWEsWUFBWSxDQUFDQyxRQUNqQnBCLFVBQVUsQ0FBQ29CLE1BQU0sSUFBSXBCLFVBQVUsQ0FBQ1ksaUJBQWlCO0FBRW5ELE1BQU1TLFdBQVcsQ0FBQ0QsT0FBaUJFLFNBQWlCQztJQUNsRCxJQUFJLENBQUNKLFVBQVVDLFFBQVE7SUFFdkIsTUFBTUksUUFBUTtRQUNaQyxJQUFJLElBQUlDLE9BQU9DLFdBQVc7UUFDMUJQO1FBQ0FRLEtBQUtOO1FBQ0wsR0FBR0wsU0FBUztRQUNaLEdBQUlNLFFBQVEsQ0FBQyxDQUFDO0lBQ2hCO0lBRUEsSUFBSU0sT0FBTztJQUNYLElBQUk7UUFDRkEsT0FBT0MsS0FBS0MsU0FBUyxDQUFDUDtJQUN4QixFQUFFLE9BQU07UUFDTkssT0FBT0MsS0FBS0MsU0FBUyxDQUFDO1lBQ3BCTixJQUFJRCxNQUFNQyxFQUFFO1lBQ1pMO1lBQ0FRLEtBQUtOO1lBQ0wsR0FBR0wsU0FBUztZQUNaYixPQUFPO1FBQ1Q7SUFDRjtJQUVBLE1BQU00QixPQUFPWixVQUFVLFVBQVVhLFFBQVE3QixLQUFLLEdBQUdnQixVQUFVLFNBQVNhLFFBQVE5QixJQUFJLEdBQUc4QixRQUFRQyxHQUFHO0lBQzlGRixLQUFLSDtBQUNQO0FBRU8sTUFBTU0sZUFBZSxDQUFDQyxXQUFvQixDQUFDLENBQUM7SUFDakQsTUFBTUMsYUFBYTtRQUFFLEdBQUdELFFBQVE7SUFBQztJQUNqQyxPQUFPO1FBQ0xuQyxPQUFPLENBQUNxQixTQUFTQyxPQUFTRixTQUFTLFNBQVNDLFNBQVM7Z0JBQUUsR0FBR2UsVUFBVTtnQkFBRSxHQUFHZCxJQUFJO1lBQUM7UUFDOUVyQixNQUFNLENBQUNvQixTQUFTQyxPQUFTRixTQUFTLFFBQVFDLFNBQVM7Z0JBQUUsR0FBR2UsVUFBVTtnQkFBRSxHQUFHZCxJQUFJO1lBQUM7UUFDNUVwQixNQUFNLENBQUNtQixTQUFTQyxPQUFTRixTQUFTLFFBQVFDLFNBQVM7Z0JBQUUsR0FBR2UsVUFBVTtnQkFBRSxHQUFHZCxJQUFJO1lBQUM7UUFDNUVuQixPQUFPLENBQUNrQixTQUFTQyxPQUFTRixTQUFTLFNBQVNDLFNBQVM7Z0JBQUUsR0FBR2UsVUFBVTtnQkFBRSxHQUFHZCxJQUFJO1lBQUM7UUFDOUVlLE9BQU8sQ0FBQ2YsT0FBU1ksYUFBYTtnQkFBRSxHQUFHRSxVQUFVO2dCQUFFLEdBQUdkLElBQUk7WUFBQztJQUN6RDtBQUNGLEVBQUU7QUFFRixNQUFNZ0IsdUJBQXVCLENBQUNDLFVBQzVCQSxRQUFRQyxHQUFHLENBQUMsbUJBQ1pELFFBQVFDLEdBQUcsQ0FBQyxrQkFDWkQsUUFBUUMsR0FBRyxDQUFDLHNCQUNaMUMsdURBQVVBO0FBRUwsTUFBTTJDLHNCQUFzQixDQUNqQ0MsU0FDQVAsV0FBb0IsQ0FBQyxDQUFDO0lBRXRCLE1BQU1RLE1BQU0sSUFBSUMsSUFBSUYsUUFBUUMsR0FBRztJQUMvQixPQUFPVCxhQUFhO1FBQ2xCLEdBQUdDLFFBQVE7UUFDWFUsV0FBV1AscUJBQXFCSSxRQUFRSCxPQUFPO1FBQy9DTyxRQUFRSixRQUFRSSxNQUFNO1FBQ3RCQyxNQUFNSixJQUFJSyxRQUFRO0lBQ3BCO0FBQ0YsRUFBRTtBQUVLLE1BQU1DLGlCQUFpQixDQUM1QkM7SUFFQSxNQUFNQyxVQUFVRCxPQUFPekMsT0FBT0M7SUFDOUIsSUFBSSxDQUFDeUMsU0FBUyxPQUFPLENBQUM7SUFDdEIsSUFBSXJDLFNBQVM7UUFDWCxPQUFPO1lBQUVvQyxPQUFPQztRQUFRO0lBQzFCO0lBQ0EsTUFBTSxHQUFHQyxTQUFTLFNBQVMsQ0FBQyxHQUFHRCxRQUFRRSxLQUFLLENBQUM7SUFDN0MsTUFBTUMsWUFBWXpELHVEQUFVQSxDQUFDLFVBQVUwRCxNQUFNLENBQUNKLFNBQVNLLE1BQU0sQ0FBQyxPQUFPQyxLQUFLLENBQUMsR0FBRztJQUM5RSxPQUFPO1FBQUVIO1FBQVdJLGFBQWFOO0lBQU87QUFDMUMsRUFBRTtBQUVLLE1BQU1PLGlCQUFpQixDQUFDeEQ7SUFDN0IsSUFBSUEsaUJBQWlCeUQsT0FBTztRQUMxQixPQUFPO1lBQ0xDLE1BQU0xRCxNQUFNMEQsSUFBSTtZQUNoQnhDLFNBQVNsQixNQUFNa0IsT0FBTztZQUN0QnlDLE9BQU8zRCxNQUFNMkQsS0FBSyxJQUFJO1FBQ3hCO0lBQ0Y7SUFDQSxJQUFJLE9BQU8zRCxVQUFVLFVBQVU7UUFDN0IsT0FBTztZQUFFa0IsU0FBU2xCO1FBQU07SUFDMUI7SUFDQSxJQUFJO1FBQ0YsT0FBTztZQUFFa0IsU0FBU1EsS0FBS0MsU0FBUyxDQUFDM0I7UUFBTztJQUMxQyxFQUFFLE9BQU07UUFDTixPQUFPO1lBQUVrQixTQUFTMEMsT0FBTzVEO1FBQU87SUFDbEM7QUFDRixFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvcnlhbnJvc3p0b2N6eS9EZXZlbG9wbWVudC9tYWluc3RyZWV0YWktd2Vic2l0ZS9hcHBzL21lbWJlcnMvbGliL2xvZ2dpbmcvc2VydmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcInNlcnZlci1vbmx5XCI7XG5cbmltcG9ydCB7IGNyZWF0ZUhhc2gsIHJhbmRvbVVVSUQgfSBmcm9tIFwibm9kZTpjcnlwdG9cIjtcbmltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3QgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcblxuLy8gU3RydWN0dXJlZCBKU09OIGxvZ2dlciBmb3Igc2VydmVyLXNpZGUgbWVtYmVycyBmbG93cyAoc3Rkb3V0LWZyaWVuZGx5IGZvciBWZXJjZWwvZGV2KS5cbnR5cGUgTG9nTGV2ZWwgPSBcImRlYnVnXCIgfCBcImluZm9cIiB8IFwid2FyblwiIHwgXCJlcnJvclwiO1xuZXhwb3J0IHR5cGUgTG9nTWV0YSA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuXG5leHBvcnQgdHlwZSBMb2dnZXIgPSB7XG4gIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogTG9nTWV0YSkgPT4gdm9pZDtcbiAgaW5mbzogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGEpID0+IHZvaWQ7XG4gIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhKSA9PiB2b2lkO1xuICBlcnJvcjogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGEpID0+IHZvaWQ7XG4gIGNoaWxkOiAobWV0YTogTG9nTWV0YSkgPT4gTG9nZ2VyO1xufTtcblxuY29uc3QgTE9HX0xFVkVMUzogUmVjb3JkPExvZ0xldmVsLCBudW1iZXI+ID0ge1xuICBkZWJ1ZzogMTAsXG4gIGluZm86IDIwLFxuICB3YXJuOiAzMCxcbiAgZXJyb3I6IDQwLFxufTtcblxuY29uc3QgREVGQVVMVF9MT0dfTEVWRUw6IExvZ0xldmVsID1cbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiID8gXCJpbmZvXCIgOiBcImRlYnVnXCI7XG5cbmNvbnN0IG5vcm1hbGl6ZUxvZ0xldmVsID0gKHZhbHVlPzogc3RyaW5nIHwgbnVsbCk6IExvZ0xldmVsID0+IHtcbiAgaWYgKCF2YWx1ZSkgcmV0dXJuIERFRkFVTFRfTE9HX0xFVkVMO1xuICBjb25zdCBub3JtYWxpemVkID0gdmFsdWUudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChub3JtYWxpemVkID09PSBcIndhcm5pbmdcIikgcmV0dXJuIFwid2FyblwiO1xuICBpZiAobm9ybWFsaXplZCBpbiBMT0dfTEVWRUxTKSByZXR1cm4gbm9ybWFsaXplZCBhcyBMb2dMZXZlbDtcbiAgcmV0dXJuIERFRkFVTFRfTE9HX0xFVkVMO1xufTtcblxuY29uc3QgQUNUSVZFX0xPR19MRVZFTCA9IG5vcm1hbGl6ZUxvZ0xldmVsKHByb2Nlc3MuZW52LkxPR19MRVZFTCk7XG5jb25zdCBMT0dfUElJID0gW1wiMVwiLCBcInRydWVcIiwgXCJ5ZXNcIiwgXCJvblwiXS5pbmNsdWRlcyhcbiAgKHByb2Nlc3MuZW52LkxPR19QSUkgPz8gXCJcIikudG9Mb3dlckNhc2UoKSxcbik7XG5cbmNvbnN0IEJBU0VfTUVUQTogTG9nTWV0YSA9IHtcbiAgYXBwOiBcIm1lbWJlcnNcIixcbiAgZW52OiBwcm9jZXNzLmVudi5OT0RFX0VOViA/PyBcImRldmVsb3BtZW50XCIsXG59O1xuXG5jb25zdCBzaG91bGRMb2cgPSAobGV2ZWw6IExvZ0xldmVsKSA9PlxuICBMT0dfTEVWRUxTW2xldmVsXSA+PSBMT0dfTEVWRUxTW0FDVElWRV9MT0dfTEVWRUxdO1xuXG5jb25zdCB3cml0ZUxvZyA9IChsZXZlbDogTG9nTGV2ZWwsIG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGEpID0+IHtcbiAgaWYgKCFzaG91bGRMb2cobGV2ZWwpKSByZXR1cm47XG5cbiAgY29uc3QgZW50cnkgPSB7XG4gICAgdHM6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICBsZXZlbCxcbiAgICBtc2c6IG1lc3NhZ2UsXG4gICAgLi4uQkFTRV9NRVRBLFxuICAgIC4uLihtZXRhID8/IHt9KSxcbiAgfTtcblxuICBsZXQgbGluZSA9IFwiXCI7XG4gIHRyeSB7XG4gICAgbGluZSA9IEpTT04uc3RyaW5naWZ5KGVudHJ5KTtcbiAgfSBjYXRjaCB7XG4gICAgbGluZSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIHRzOiBlbnRyeS50cyxcbiAgICAgIGxldmVsLFxuICAgICAgbXNnOiBtZXNzYWdlLFxuICAgICAgLi4uQkFTRV9NRVRBLFxuICAgICAgZXJyb3I6IFwibG9nLXNlcmlhbGl6YXRpb24tZmFpbGVkXCIsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBzaW5rID0gbGV2ZWwgPT09IFwiZXJyb3JcIiA/IGNvbnNvbGUuZXJyb3IgOiBsZXZlbCA9PT0gXCJ3YXJuXCIgPyBjb25zb2xlLndhcm4gOiBjb25zb2xlLmxvZztcbiAgc2luayhsaW5lKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVMb2dnZXIgPSAoYmFzZU1ldGE6IExvZ01ldGEgPSB7fSk6IExvZ2dlciA9PiB7XG4gIGNvbnN0IG1lcmdlZEJhc2UgPSB7IC4uLmJhc2VNZXRhIH07XG4gIHJldHVybiB7XG4gICAgZGVidWc6IChtZXNzYWdlLCBtZXRhKSA9PiB3cml0ZUxvZyhcImRlYnVnXCIsIG1lc3NhZ2UsIHsgLi4ubWVyZ2VkQmFzZSwgLi4ubWV0YSB9KSxcbiAgICBpbmZvOiAobWVzc2FnZSwgbWV0YSkgPT4gd3JpdGVMb2coXCJpbmZvXCIsIG1lc3NhZ2UsIHsgLi4ubWVyZ2VkQmFzZSwgLi4ubWV0YSB9KSxcbiAgICB3YXJuOiAobWVzc2FnZSwgbWV0YSkgPT4gd3JpdGVMb2coXCJ3YXJuXCIsIG1lc3NhZ2UsIHsgLi4ubWVyZ2VkQmFzZSwgLi4ubWV0YSB9KSxcbiAgICBlcnJvcjogKG1lc3NhZ2UsIG1ldGEpID0+IHdyaXRlTG9nKFwiZXJyb3JcIiwgbWVzc2FnZSwgeyAuLi5tZXJnZWRCYXNlLCAuLi5tZXRhIH0pLFxuICAgIGNoaWxkOiAobWV0YSkgPT4gY3JlYXRlTG9nZ2VyKHsgLi4ubWVyZ2VkQmFzZSwgLi4ubWV0YSB9KSxcbiAgfTtcbn07XG5cbmNvbnN0IHJlcXVlc3RJZEZyb21IZWFkZXJzID0gKGhlYWRlcnM6IEhlYWRlcnMpID0+XG4gIGhlYWRlcnMuZ2V0KFwieC1yZXF1ZXN0LWlkXCIpID8/XG4gIGhlYWRlcnMuZ2V0KFwieC12ZXJjZWwtaWRcIikgPz9cbiAgaGVhZGVycy5nZXQoXCJ4LWFtem4tdHJhY2UtaWRcIikgPz9cbiAgcmFuZG9tVVVJRCgpO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlUmVxdWVzdExvZ2dlciA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGJhc2VNZXRhOiBMb2dNZXRhID0ge30sXG4pOiBMb2dnZXIgPT4ge1xuICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgcmV0dXJuIGNyZWF0ZUxvZ2dlcih7XG4gICAgLi4uYmFzZU1ldGEsXG4gICAgcmVxdWVzdElkOiByZXF1ZXN0SWRGcm9tSGVhZGVycyhyZXF1ZXN0LmhlYWRlcnMpLFxuICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgcGF0aDogdXJsLnBhdGhuYW1lLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbWFpbFRvTG9nTWV0YSA9IChcbiAgZW1haWw6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsXG4pOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0+IHtcbiAgY29uc3QgdHJpbW1lZCA9IGVtYWlsPy50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgaWYgKCF0cmltbWVkKSByZXR1cm4ge307XG4gIGlmIChMT0dfUElJKSB7XG4gICAgcmV0dXJuIHsgZW1haWw6IHRyaW1tZWQgfTtcbiAgfVxuICBjb25zdCBbLCBkb21haW4gPSBcInVua25vd25cIl0gPSB0cmltbWVkLnNwbGl0KFwiQFwiKTtcbiAgY29uc3QgZW1haWxIYXNoID0gY3JlYXRlSGFzaChcInNoYTI1NlwiKS51cGRhdGUodHJpbW1lZCkuZGlnZXN0KFwiaGV4XCIpLnNsaWNlKDAsIDEyKTtcbiAgcmV0dXJuIHsgZW1haWxIYXNoLCBlbWFpbERvbWFpbjogZG9tYWluIH07XG59O1xuXG5leHBvcnQgY29uc3Qgc2VyaWFsaXplRXJyb3IgPSAoZXJyb3I6IHVua25vd24pOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0+IHtcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICBzdGFjazogZXJyb3Iuc3RhY2sgPz8gXCJcIixcbiAgICB9O1xuICB9XG4gIGlmICh0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4geyBtZXNzYWdlOiBlcnJvciB9O1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIHsgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkoZXJyb3IpIH07XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7IG1lc3NhZ2U6IFN0cmluZyhlcnJvcikgfTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVIYXNoIiwicmFuZG9tVVVJRCIsIkxPR19MRVZFTFMiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiLCJERUZBVUxUX0xPR19MRVZFTCIsInByb2Nlc3MiLCJub3JtYWxpemVMb2dMZXZlbCIsInZhbHVlIiwibm9ybWFsaXplZCIsInRyaW0iLCJ0b0xvd2VyQ2FzZSIsIkFDVElWRV9MT0dfTEVWRUwiLCJlbnYiLCJMT0dfTEVWRUwiLCJMT0dfUElJIiwiaW5jbHVkZXMiLCJCQVNFX01FVEEiLCJhcHAiLCJzaG91bGRMb2ciLCJsZXZlbCIsIndyaXRlTG9nIiwibWVzc2FnZSIsIm1ldGEiLCJlbnRyeSIsInRzIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwibXNnIiwibGluZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzaW5rIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZUxvZ2dlciIsImJhc2VNZXRhIiwibWVyZ2VkQmFzZSIsImNoaWxkIiwicmVxdWVzdElkRnJvbUhlYWRlcnMiLCJoZWFkZXJzIiwiZ2V0IiwiY3JlYXRlUmVxdWVzdExvZ2dlciIsInJlcXVlc3QiLCJ1cmwiLCJVUkwiLCJyZXF1ZXN0SWQiLCJtZXRob2QiLCJwYXRoIiwicGF0aG5hbWUiLCJlbWFpbFRvTG9nTWV0YSIsImVtYWlsIiwidHJpbW1lZCIsImRvbWFpbiIsInNwbGl0IiwiZW1haWxIYXNoIiwidXBkYXRlIiwiZGlnZXN0Iiwic2xpY2UiLCJlbWFpbERvbWFpbiIsInNlcmlhbGl6ZUVycm9yIiwiRXJyb3IiLCJuYW1lIiwic3RhY2siLCJTdHJpbmciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/logging/server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/newsletter/buttondown.ts":
/*!**************************************!*\
  !*** ./lib/newsletter/buttondown.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SUBSCRIBED_COOKIE_MAX_AGE_SECONDS: () => (/* binding */ SUBSCRIBED_COOKIE_MAX_AGE_SECONDS),\n/* harmony export */   SUBSCRIBED_COOKIE_NAME: () => (/* binding */ SUBSCRIBED_COOKIE_NAME),\n/* harmony export */   getButtondownSubscriber: () => (/* binding */ getButtondownSubscriber),\n/* harmony export */   subscribeToButtondown: () => (/* binding */ subscribeToButtondown),\n/* harmony export */   subscribedCookieOptions: () => (/* binding */ subscribedCookieOptions)\n/* harmony export */ });\n/* harmony import */ var _lib_logging_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logging/server */ \"(rsc)/./lib/logging/server.ts\");\n/* harmony import */ var _lib_auth_session__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth/session */ \"(rsc)/./lib/auth/session.ts\");\n\n\nconst resolveButtondownApiBase = ()=>{\n    const raw = (process.env.BUTTONDOWN_API_BASE_URL ?? \"\").trim();\n    const base = raw || \"https://api.buttondown.com/v1\";\n    return base.replace(/\\/+$/, \"\");\n};\nconst BUTTONDOWN_API_BASE = resolveButtondownApiBase();\nconst normalizeButtondownApiKey = (value)=>{\n    let token = value.trim();\n    if (!token) return \"\";\n    token = token.replace(/^authorization:\\s*/i, \"\").trim();\n    token = token.replace(/^token\\s+/i, \"\").trim();\n    return token;\n};\nconst BUTTONDOWN_API_TOKEN = normalizeButtondownApiKey(process.env.BUTTONDOWN_API_KEY ?? \"\");\nconst BUTTONDOWN_AUTH_HEADER = BUTTONDOWN_API_TOKEN ? `Token ${BUTTONDOWN_API_TOKEN}` : \"\";\nconst SUBSCRIBED_COOKIE_NAME = \"msai_subscribed\";\nconst SUBSCRIBED_COOKIE_MAX_AGE_SECONDS = _lib_auth_session__WEBPACK_IMPORTED_MODULE_1__.SESSION_MAX_AGE_SECONDS;\nconst subscribedCookieOptions = {\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: \"development\" === \"production\",\n    path: \"/\",\n    maxAge: SUBSCRIBED_COOKIE_MAX_AGE_SECONDS\n};\nconst PLACEHOLDER_TAGS = [];\nconst PLACEHOLDER_METADATA = {};\nconst isValidEmail = (email)=>email.includes(\"@\");\nconst SUBSCRIBER_TYPE = \"regular\";\nconst buildSubscriberUrl = (idOrEmail)=>`${BUTTONDOWN_API_BASE}/subscribers/${encodeURIComponent(idOrEmail)}`;\nconst buildAttribution = (returnTo, origin)=>{\n    if (!returnTo || !origin) {\n        return {};\n    }\n    try {\n        const url = new URL(returnTo, origin);\n        const params = url.searchParams;\n        const attribution = {\n            referrer_url: url.toString()\n        };\n        const utmSource = params.get(\"utm_source\");\n        const utmMedium = params.get(\"utm_medium\");\n        const utmCampaign = params.get(\"utm_campaign\");\n        const utmTerm = params.get(\"utm_term\");\n        const utmContent = params.get(\"utm_content\");\n        if (utmSource) attribution.utm_source = utmSource;\n        if (utmMedium) attribution.utm_medium = utmMedium;\n        if (utmCampaign) attribution.utm_campaign = utmCampaign;\n        if (utmTerm) attribution.utm_term = utmTerm;\n        if (utmContent) attribution.utm_content = utmContent;\n        return attribution;\n    } catch  {\n        return {};\n    }\n};\nconst readButtondownError = async (response)=>{\n    try {\n        const body = await response.json();\n        if (typeof body?.detail === \"string\") {\n            return body.detail;\n        }\n        if (typeof body?.message === \"string\") {\n            return body.message;\n        }\n        return JSON.stringify(body);\n    } catch  {\n        try {\n            return await response.text();\n        } catch  {\n            return \"buttondown-request-failed\";\n        }\n    }\n};\nconst isAlreadySubscribed = (message)=>{\n    const normalized = message.toLowerCase();\n    return normalized.includes(\"already\") || normalized.includes(\"exists\") || normalized.includes(\"subscribed\");\n};\nconst updateExistingSubscriber = async ({ email, returnTo, origin, logger })=>{\n    const log = (logger ?? (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        scope: \"newsletter.buttondown\"\n    })).child({\n        scope: \"newsletter.buttondown\"\n    });\n    if (!BUTTONDOWN_AUTH_HEADER) {\n        log.error(\"newsletter.buttondown.missing_api_key\");\n        return {\n            status: \"failed\",\n            error: \"missing-api-key\"\n        };\n    }\n    const payload = {\n        type: SUBSCRIBER_TYPE,\n        ...buildAttribution(returnTo, origin)\n    };\n    try {\n        const response = await fetch(buildSubscriberUrl(email.toLowerCase()), {\n            method: \"PATCH\",\n            headers: {\n                Authorization: BUTTONDOWN_AUTH_HEADER,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(payload)\n        });\n        if (response.ok) {\n            log.debug(\"newsletter.buttondown.update_success\", {\n                status: response.status\n            });\n            return {\n                status: \"already_subscribed\"\n            };\n        }\n        const message = await readButtondownError(response);\n        log.warn(\"newsletter.buttondown.update_failed\", {\n            status: response.status,\n            error: message\n        });\n        return {\n            status: \"failed\",\n            error: message\n        };\n    } catch (error) {\n        const message = error instanceof Error ? error.message : \"buttondown-request-failed\";\n        log.error(\"newsletter.buttondown.update_exception\", {\n            error: (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.serializeError)(error)\n        });\n        return {\n            status: \"failed\",\n            error: message\n        };\n    }\n};\nconst subscribeToButtondown = async ({ email, returnTo, origin, logger })=>{\n    const log = (logger ?? (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        scope: \"newsletter.buttondown\"\n    })).child({\n        scope: \"newsletter.buttondown\"\n    });\n    const emailMeta = (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.emailToLogMeta)(email);\n    log.debug(\"newsletter.buttondown.requested\", {\n        ...emailMeta,\n        hasReturnTo: Boolean(returnTo),\n        hasOrigin: Boolean(origin)\n    });\n    if (!email || !isValidEmail(email)) {\n        log.warn(\"newsletter.buttondown.invalid_email\", {\n            ...emailMeta\n        });\n        return {\n            status: \"failed\",\n            error: \"invalid-email\"\n        };\n    }\n    if (!BUTTONDOWN_AUTH_HEADER) {\n        log.error(\"newsletter.buttondown.missing_api_key\");\n        return {\n            status: \"failed\",\n            error: \"missing-api-key\"\n        };\n    }\n    const payload = {\n        email_address: email.toLowerCase(),\n        type: SUBSCRIBER_TYPE,\n        ...buildAttribution(returnTo, origin)\n    };\n    if (PLACEHOLDER_TAGS.length > 0) {\n        payload.tags = PLACEHOLDER_TAGS;\n    }\n    if (Object.keys(PLACEHOLDER_METADATA).length > 0) {\n        payload.metadata = PLACEHOLDER_METADATA;\n    }\n    try {\n        const response = await fetch(`${BUTTONDOWN_API_BASE}/subscribers`, {\n            method: \"POST\",\n            headers: {\n                Authorization: BUTTONDOWN_AUTH_HEADER,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(payload)\n        });\n        if (response.ok) {\n            log.debug(\"newsletter.buttondown.success\", {\n                status: response.status\n            });\n            return {\n                status: \"subscribed\"\n            };\n        }\n        const message = await readButtondownError(response);\n        if (response.status === 409 || isAlreadySubscribed(message)) {\n            log.debug(\"newsletter.buttondown.already_subscribed\", {\n                status: response.status,\n                error: message\n            });\n            const updateResult = await updateExistingSubscriber({\n                email,\n                returnTo,\n                origin,\n                logger: log\n            });\n            if (updateResult.status === \"failed\") {\n                return {\n                    status: \"failed\",\n                    error: updateResult.error ?? message\n                };\n            }\n            return {\n                status: \"already_subscribed\",\n                error: message\n            };\n        }\n        log.warn(\"newsletter.buttondown.failed\", {\n            status: response.status,\n            error: message\n        });\n        return {\n            status: \"failed\",\n            error: message\n        };\n    } catch (error) {\n        const message = error instanceof Error ? error.message : \"buttondown-request-failed\";\n        log.error(\"newsletter.buttondown.exception\", {\n            error: (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.serializeError)(error)\n        });\n        return {\n            status: \"failed\",\n            error: message\n        };\n    }\n};\nconst getButtondownSubscriber = async ({ idOrEmail, logger })=>{\n    const log = (logger ?? (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.createLogger)({\n        scope: \"newsletter.buttondown\"\n    })).child({\n        scope: \"newsletter.buttondown\"\n    });\n    if (!idOrEmail) {\n        log.warn(\"newsletter.buttondown.get_subscriber.invalid_ref\");\n        return null;\n    }\n    if (!BUTTONDOWN_AUTH_HEADER) {\n        log.error(\"newsletter.buttondown.missing_api_key\");\n        return null;\n    }\n    try {\n        const response = await fetch(buildSubscriberUrl(idOrEmail), {\n            headers: {\n                Authorization: BUTTONDOWN_AUTH_HEADER\n            }\n        });\n        if (!response.ok) {\n            const message = await readButtondownError(response);\n            log.warn(\"newsletter.buttondown.get_subscriber.failed\", {\n                status: response.status,\n                error: message\n            });\n            return null;\n        }\n        const body = await response.json();\n        if (body && typeof body === \"object\" && typeof body.email_address === \"string\" && typeof body.id === \"string\") {\n            return body;\n        }\n        log.warn(\"newsletter.buttondown.get_subscriber.invalid_response_shape\");\n        return null;\n    } catch (error) {\n        log.error(\"newsletter.buttondown.get_subscriber.exception\", {\n            error: (0,_lib_logging_server__WEBPACK_IMPORTED_MODULE_0__.serializeError)(error)\n        });\n        return null;\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjQSxDQUFDd0U7UUFDeEI7UUFDQSxPQUFPO0lBQ1Q7QUFDRixFQUFFIiwic291cmNlcyI6WyIvVXNlcnMvcnlhbnJvc3p0b2N6eS9EZXZlbG9wbWVudC9tYWluc3RyZWV0YWktd2Vic2l0ZS9hcHBzL21lbWJlcnMvbGliL25ld3NsZXR0ZXIvYnV0dG9uZG93bi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBjcmVhdGVMb2dnZXIsXG4gIGVtYWlsVG9Mb2dNZXRhLFxuICBzZXJpYWxpemVFcnJvcixcbiAgdHlwZSBMb2dnZXIsXG59IGZyb20gXCJAL2xpYi9sb2dnaW5nL3NlcnZlclwiO1xuaW1wb3J0IHsgU0VTU0lPTl9NQVhfQUdFX1NFQ09ORFMgfSBmcm9tIFwiQC9saWIvYXV0aC9zZXNzaW9uXCI7XG5cbnR5cGUgU3Vic2NyaWJlQ29udGV4dCA9IHtcbiAgZW1haWw6IHN0cmluZztcbiAgcmV0dXJuVG8/OiBzdHJpbmcgfCBudWxsO1xuICBvcmlnaW4/OiBzdHJpbmcgfCBudWxsO1xuICBsb2dnZXI/OiBMb2dnZXI7XG59O1xuXG5leHBvcnQgdHlwZSBCdXR0b25kb3duU3Vic2NyaWJlciA9IHtcbiAgaWQ6IHN0cmluZztcbiAgZW1haWxfYWRkcmVzczogc3RyaW5nO1xuICB0YWdzPzogc3RyaW5nW107XG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIFtrZXk6IHN0cmluZ106IHVua25vd247XG59O1xuXG5leHBvcnQgdHlwZSBTdWJzY3JpYmVSZXN1bHQgPSB7XG4gIHN0YXR1czogXCJzdWJzY3JpYmVkXCIgfCBcImFscmVhZHlfc3Vic2NyaWJlZFwiIHwgXCJmYWlsZWRcIjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59O1xuXG5jb25zdCByZXNvbHZlQnV0dG9uZG93bkFwaUJhc2UgPSAoKSA9PiB7XG4gIGNvbnN0IHJhdyA9IChwcm9jZXNzLmVudi5CVVRUT05ET1dOX0FQSV9CQVNFX1VSTCA/PyBcIlwiKS50cmltKCk7XG4gIGNvbnN0IGJhc2UgPSByYXcgfHwgXCJodHRwczovL2FwaS5idXR0b25kb3duLmNvbS92MVwiO1xuICByZXR1cm4gYmFzZS5yZXBsYWNlKC9cXC8rJC8sIFwiXCIpO1xufTtcblxuY29uc3QgQlVUVE9ORE9XTl9BUElfQkFTRSA9IHJlc29sdmVCdXR0b25kb3duQXBpQmFzZSgpO1xuXG5jb25zdCBub3JtYWxpemVCdXR0b25kb3duQXBpS2V5ID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgbGV0IHRva2VuID0gdmFsdWUudHJpbSgpO1xuICBpZiAoIXRva2VuKSByZXR1cm4gXCJcIjtcbiAgdG9rZW4gPSB0b2tlbi5yZXBsYWNlKC9eYXV0aG9yaXphdGlvbjpcXHMqL2ksIFwiXCIpLnRyaW0oKTtcbiAgdG9rZW4gPSB0b2tlbi5yZXBsYWNlKC9edG9rZW5cXHMrL2ksIFwiXCIpLnRyaW0oKTtcbiAgcmV0dXJuIHRva2VuO1xufTtcblxuY29uc3QgQlVUVE9ORE9XTl9BUElfVE9LRU4gPSBub3JtYWxpemVCdXR0b25kb3duQXBpS2V5KFxuICBwcm9jZXNzLmVudi5CVVRUT05ET1dOX0FQSV9LRVkgPz8gXCJcIixcbik7XG5jb25zdCBCVVRUT05ET1dOX0FVVEhfSEVBREVSID0gQlVUVE9ORE9XTl9BUElfVE9LRU5cbiAgPyBgVG9rZW4gJHtCVVRUT05ET1dOX0FQSV9UT0tFTn1gXG4gIDogXCJcIjtcblxuZXhwb3J0IGNvbnN0IFNVQlNDUklCRURfQ09PS0lFX05BTUUgPSBcIm1zYWlfc3Vic2NyaWJlZFwiO1xuZXhwb3J0IGNvbnN0IFNVQlNDUklCRURfQ09PS0lFX01BWF9BR0VfU0VDT05EUyA9IFNFU1NJT05fTUFYX0FHRV9TRUNPTkRTO1xuZXhwb3J0IGNvbnN0IHN1YnNjcmliZWRDb29raWVPcHRpb25zID0ge1xuICBodHRwT25seTogdHJ1ZSxcbiAgc2FtZVNpdGU6IFwibGF4XCIgYXMgY29uc3QsXG4gIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiLFxuICBwYXRoOiBcIi9cIixcbiAgbWF4QWdlOiBTVUJTQ1JJQkVEX0NPT0tJRV9NQVhfQUdFX1NFQ09ORFMsXG59O1xuXG5jb25zdCBQTEFDRUhPTERFUl9UQUdTOiBzdHJpbmdbXSA9IFtdO1xuY29uc3QgUExBQ0VIT0xERVJfTUVUQURBVEE6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcblxuY29uc3QgaXNWYWxpZEVtYWlsID0gKGVtYWlsOiBzdHJpbmcpID0+IGVtYWlsLmluY2x1ZGVzKFwiQFwiKTtcbmNvbnN0IFNVQlNDUklCRVJfVFlQRTogXCJ1bmFjdGl2YXRlZFwiIHwgXCJyZWd1bGFyXCIgPSBcInJlZ3VsYXJcIjtcbmNvbnN0IGJ1aWxkU3Vic2NyaWJlclVybCA9IChpZE9yRW1haWw6IHN0cmluZykgPT5cbiAgYCR7QlVUVE9ORE9XTl9BUElfQkFTRX0vc3Vic2NyaWJlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoaWRPckVtYWlsKX1gO1xuXG5jb25zdCBidWlsZEF0dHJpYnV0aW9uID0gKHJldHVyblRvPzogc3RyaW5nIHwgbnVsbCwgb3JpZ2luPzogc3RyaW5nIHwgbnVsbCkgPT4ge1xuICBpZiAoIXJldHVyblRvIHx8ICFvcmlnaW4pIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocmV0dXJuVG8sIG9yaWdpbik7XG4gICAgY29uc3QgcGFyYW1zID0gdXJsLnNlYXJjaFBhcmFtcztcbiAgICBjb25zdCBhdHRyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgIHJlZmVycmVyX3VybDogdXJsLnRvU3RyaW5nKCksXG4gICAgfTtcblxuICAgIGNvbnN0IHV0bVNvdXJjZSA9IHBhcmFtcy5nZXQoXCJ1dG1fc291cmNlXCIpO1xuICAgIGNvbnN0IHV0bU1lZGl1bSA9IHBhcmFtcy5nZXQoXCJ1dG1fbWVkaXVtXCIpO1xuICAgIGNvbnN0IHV0bUNhbXBhaWduID0gcGFyYW1zLmdldChcInV0bV9jYW1wYWlnblwiKTtcbiAgICBjb25zdCB1dG1UZXJtID0gcGFyYW1zLmdldChcInV0bV90ZXJtXCIpO1xuICAgIGNvbnN0IHV0bUNvbnRlbnQgPSBwYXJhbXMuZ2V0KFwidXRtX2NvbnRlbnRcIik7XG5cbiAgICBpZiAodXRtU291cmNlKSBhdHRyaWJ1dGlvbi51dG1fc291cmNlID0gdXRtU291cmNlO1xuICAgIGlmICh1dG1NZWRpdW0pIGF0dHJpYnV0aW9uLnV0bV9tZWRpdW0gPSB1dG1NZWRpdW07XG4gICAgaWYgKHV0bUNhbXBhaWduKSBhdHRyaWJ1dGlvbi51dG1fY2FtcGFpZ24gPSB1dG1DYW1wYWlnbjtcbiAgICBpZiAodXRtVGVybSkgYXR0cmlidXRpb24udXRtX3Rlcm0gPSB1dG1UZXJtO1xuICAgIGlmICh1dG1Db250ZW50KSBhdHRyaWJ1dGlvbi51dG1fY29udGVudCA9IHV0bUNvbnRlbnQ7XG5cbiAgICByZXR1cm4gYXR0cmlidXRpb247XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7fTtcbiAgfVxufTtcblxuY29uc3QgcmVhZEJ1dHRvbmRvd25FcnJvciA9IGFzeW5jIChyZXNwb25zZTogUmVzcG9uc2UpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIGlmICh0eXBlb2YgYm9keT8uZGV0YWlsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gYm9keS5kZXRhaWw7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYm9keT8ubWVzc2FnZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIGJvZHkubWVzc2FnZTtcbiAgICB9XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICB9IGNhdGNoIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBcImJ1dHRvbmRvd24tcmVxdWVzdC1mYWlsZWRcIjtcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGlzQWxyZWFkeVN1YnNjcmliZWQgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKCk7XG4gIHJldHVybiAoXG4gICAgbm9ybWFsaXplZC5pbmNsdWRlcyhcImFscmVhZHlcIikgfHxcbiAgICBub3JtYWxpemVkLmluY2x1ZGVzKFwiZXhpc3RzXCIpIHx8XG4gICAgbm9ybWFsaXplZC5pbmNsdWRlcyhcInN1YnNjcmliZWRcIilcbiAgKTtcbn07XG5cbmNvbnN0IHVwZGF0ZUV4aXN0aW5nU3Vic2NyaWJlciA9IGFzeW5jICh7XG4gIGVtYWlsLFxuICByZXR1cm5UbyxcbiAgb3JpZ2luLFxuICBsb2dnZXIsXG59OiBTdWJzY3JpYmVDb250ZXh0KTogUHJvbWlzZTxTdWJzY3JpYmVSZXN1bHQ+ID0+IHtcbiAgY29uc3QgbG9nID0gKGxvZ2dlciA/PyBjcmVhdGVMb2dnZXIoeyBzY29wZTogXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd25cIiB9KSkuY2hpbGQoXG4gICAgeyBzY29wZTogXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd25cIiB9LFxuICApO1xuXG4gIGlmICghQlVUVE9ORE9XTl9BVVRIX0hFQURFUikge1xuICAgIGxvZy5lcnJvcihcIm5ld3NsZXR0ZXIuYnV0dG9uZG93bi5taXNzaW5nX2FwaV9rZXlcIik7XG4gICAgcmV0dXJuIHsgc3RhdHVzOiBcImZhaWxlZFwiLCBlcnJvcjogXCJtaXNzaW5nLWFwaS1rZXlcIiB9O1xuICB9XG5cbiAgY29uc3QgcGF5bG9hZDogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7XG4gICAgdHlwZTogU1VCU0NSSUJFUl9UWVBFLFxuICAgIC4uLmJ1aWxkQXR0cmlidXRpb24ocmV0dXJuVG8sIG9yaWdpbiksXG4gIH07XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGJ1aWxkU3Vic2NyaWJlclVybChlbWFpbC50b0xvd2VyQ2FzZSgpKSwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IEJVVFRPTkRPV05fQVVUSF9IRUFERVIsXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLFxuICAgIH0pO1xuXG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICBsb2cuZGVidWcoXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24udXBkYXRlX3N1Y2Nlc3NcIiwge1xuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiBcImFscmVhZHlfc3Vic2NyaWJlZFwiIH07XG4gICAgfVxuXG4gICAgY29uc3QgbWVzc2FnZSA9IGF3YWl0IHJlYWRCdXR0b25kb3duRXJyb3IocmVzcG9uc2UpO1xuICAgIGxvZy53YXJuKFwibmV3c2xldHRlci5idXR0b25kb3duLnVwZGF0ZV9mYWlsZWRcIiwge1xuICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICBlcnJvcjogbWVzc2FnZSxcbiAgICB9KTtcbiAgICByZXR1cm4geyBzdGF0dXM6IFwiZmFpbGVkXCIsIGVycm9yOiBtZXNzYWdlIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiYnV0dG9uZG93bi1yZXF1ZXN0LWZhaWxlZFwiO1xuICAgIGxvZy5lcnJvcihcIm5ld3NsZXR0ZXIuYnV0dG9uZG93bi51cGRhdGVfZXhjZXB0aW9uXCIsIHtcbiAgICAgIGVycm9yOiBzZXJpYWxpemVFcnJvcihlcnJvciksXG4gICAgfSk7XG4gICAgcmV0dXJuIHsgc3RhdHVzOiBcImZhaWxlZFwiLCBlcnJvcjogbWVzc2FnZSB9O1xuICB9XG59O1xuXG5leHBvcnQgY29uc3Qgc3Vic2NyaWJlVG9CdXR0b25kb3duID0gYXN5bmMgKHtcbiAgZW1haWwsXG4gIHJldHVyblRvLFxuICBvcmlnaW4sXG4gIGxvZ2dlcixcbn06IFN1YnNjcmliZUNvbnRleHQpOiBQcm9taXNlPFN1YnNjcmliZVJlc3VsdD4gPT4ge1xuICBjb25zdCBsb2cgPSAobG9nZ2VyID8/IGNyZWF0ZUxvZ2dlcih7IHNjb3BlOiBcIm5ld3NsZXR0ZXIuYnV0dG9uZG93blwiIH0pKS5jaGlsZChcbiAgICB7IHNjb3BlOiBcIm5ld3NsZXR0ZXIuYnV0dG9uZG93blwiIH0sXG4gICk7XG4gIGNvbnN0IGVtYWlsTWV0YSA9IGVtYWlsVG9Mb2dNZXRhKGVtYWlsKTtcblxuICBsb2cuZGVidWcoXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24ucmVxdWVzdGVkXCIsIHtcbiAgICAuLi5lbWFpbE1ldGEsXG4gICAgaGFzUmV0dXJuVG86IEJvb2xlYW4ocmV0dXJuVG8pLFxuICAgIGhhc09yaWdpbjogQm9vbGVhbihvcmlnaW4pLFxuICB9KTtcblxuICBpZiAoIWVtYWlsIHx8ICFpc1ZhbGlkRW1haWwoZW1haWwpKSB7XG4gICAgbG9nLndhcm4oXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24uaW52YWxpZF9lbWFpbFwiLCB7XG4gICAgICAuLi5lbWFpbE1ldGEsXG4gICAgfSk7XG4gICAgcmV0dXJuIHsgc3RhdHVzOiBcImZhaWxlZFwiLCBlcnJvcjogXCJpbnZhbGlkLWVtYWlsXCIgfTtcbiAgfVxuXG4gIGlmICghQlVUVE9ORE9XTl9BVVRIX0hFQURFUikge1xuICAgIGxvZy5lcnJvcihcIm5ld3NsZXR0ZXIuYnV0dG9uZG93bi5taXNzaW5nX2FwaV9rZXlcIik7XG4gICAgcmV0dXJuIHsgc3RhdHVzOiBcImZhaWxlZFwiLCBlcnJvcjogXCJtaXNzaW5nLWFwaS1rZXlcIiB9O1xuICB9XG5cbiAgY29uc3QgcGF5bG9hZDogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7XG4gICAgZW1haWxfYWRkcmVzczogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICB0eXBlOiBTVUJTQ1JJQkVSX1RZUEUsXG4gICAgLi4uYnVpbGRBdHRyaWJ1dGlvbihyZXR1cm5Ubywgb3JpZ2luKSxcbiAgfTtcblxuICBpZiAoUExBQ0VIT0xERVJfVEFHUy5sZW5ndGggPiAwKSB7XG4gICAgcGF5bG9hZC50YWdzID0gUExBQ0VIT0xERVJfVEFHUztcbiAgfVxuXG4gIGlmIChPYmplY3Qua2V5cyhQTEFDRUhPTERFUl9NRVRBREFUQSkubGVuZ3RoID4gMCkge1xuICAgIHBheWxvYWQubWV0YWRhdGEgPSBQTEFDRUhPTERFUl9NRVRBREFUQTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtCVVRUT05ET1dOX0FQSV9CQVNFfS9zdWJzY3JpYmVyc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IEJVVFRPTkRPV05fQVVUSF9IRUFERVIsXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLFxuICAgIH0pO1xuXG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICBsb2cuZGVidWcoXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24uc3VjY2Vzc1wiLCB7IHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzIH0pO1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiBcInN1YnNjcmliZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCByZWFkQnV0dG9uZG93bkVycm9yKHJlc3BvbnNlKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkgfHwgaXNBbHJlYWR5U3Vic2NyaWJlZChtZXNzYWdlKSkge1xuICAgICAgbG9nLmRlYnVnKFwibmV3c2xldHRlci5idXR0b25kb3duLmFscmVhZHlfc3Vic2NyaWJlZFwiLCB7XG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICBlcnJvcjogbWVzc2FnZSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgdXBkYXRlUmVzdWx0ID0gYXdhaXQgdXBkYXRlRXhpc3RpbmdTdWJzY3JpYmVyKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHJldHVyblRvLFxuICAgICAgICBvcmlnaW4sXG4gICAgICAgIGxvZ2dlcjogbG9nLFxuICAgICAgfSk7XG4gICAgICBpZiAodXBkYXRlUmVzdWx0LnN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IFwiZmFpbGVkXCIsIGVycm9yOiB1cGRhdGVSZXN1bHQuZXJyb3IgPz8gbWVzc2FnZSB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgc3RhdHVzOiBcImFscmVhZHlfc3Vic2NyaWJlZFwiLCBlcnJvcjogbWVzc2FnZSB9O1xuICAgIH1cblxuICAgIGxvZy53YXJuKFwibmV3c2xldHRlci5idXR0b25kb3duLmZhaWxlZFwiLCB7XG4gICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIGVycm9yOiBtZXNzYWdlLFxuICAgIH0pO1xuICAgIHJldHVybiB7IHN0YXR1czogXCJmYWlsZWRcIiwgZXJyb3I6IG1lc3NhZ2UgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBtZXNzYWdlID1cbiAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJidXR0b25kb3duLXJlcXVlc3QtZmFpbGVkXCI7XG4gICAgbG9nLmVycm9yKFwibmV3c2xldHRlci5idXR0b25kb3duLmV4Y2VwdGlvblwiLCB7XG4gICAgICBlcnJvcjogc2VyaWFsaXplRXJyb3IoZXJyb3IpLFxuICAgIH0pO1xuICAgIHJldHVybiB7IHN0YXR1czogXCJmYWlsZWRcIiwgZXJyb3I6IG1lc3NhZ2UgfTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGdldEJ1dHRvbmRvd25TdWJzY3JpYmVyID0gYXN5bmMgKHtcbiAgaWRPckVtYWlsLFxuICBsb2dnZXIsXG59OiB7XG4gIGlkT3JFbWFpbDogc3RyaW5nO1xuICBsb2dnZXI/OiBMb2dnZXI7XG59KTogUHJvbWlzZTxCdXR0b25kb3duU3Vic2NyaWJlciB8IG51bGw+ID0+IHtcbiAgY29uc3QgbG9nID0gKGxvZ2dlciA/PyBjcmVhdGVMb2dnZXIoeyBzY29wZTogXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd25cIiB9KSkuY2hpbGQoXG4gICAgeyBzY29wZTogXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd25cIiB9LFxuICApO1xuXG4gIGlmICghaWRPckVtYWlsKSB7XG4gICAgbG9nLndhcm4oXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24uZ2V0X3N1YnNjcmliZXIuaW52YWxpZF9yZWZcIik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAoIUJVVFRPTkRPV05fQVVUSF9IRUFERVIpIHtcbiAgICBsb2cuZXJyb3IoXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24ubWlzc2luZ19hcGlfa2V5XCIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgYnVpbGRTdWJzY3JpYmVyVXJsKGlkT3JFbWFpbCksXG4gICAgICB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBCVVRUT05ET1dOX0FVVEhfSEVBREVSLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGF3YWl0IHJlYWRCdXR0b25kb3duRXJyb3IocmVzcG9uc2UpO1xuICAgICAgbG9nLndhcm4oXCJuZXdzbGV0dGVyLmJ1dHRvbmRvd24uZ2V0X3N1YnNjcmliZXIuZmFpbGVkXCIsIHtcbiAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgIGVycm9yOiBtZXNzYWdlLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBib2R5OiB1bmtub3duID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIGlmIChcbiAgICAgIGJvZHkgJiZcbiAgICAgIHR5cGVvZiBib2R5ID09PSBcIm9iamVjdFwiICYmXG4gICAgICB0eXBlb2YgKGJvZHkgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmVtYWlsX2FkZHJlc3MgPT09IFwic3RyaW5nXCIgJiZcbiAgICAgIHR5cGVvZiAoYm9keSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuaWQgPT09IFwic3RyaW5nXCJcbiAgICApIHtcbiAgICAgIHJldHVybiBib2R5IGFzIEJ1dHRvbmRvd25TdWJzY3JpYmVyO1xuICAgIH1cblxuICAgIGxvZy53YXJuKFwibmV3c2xldHRlci5idXR0b25kb3duLmdldF9zdWJzY3JpYmVyLmludmFsaWRfcmVzcG9uc2Vfc2hhcGVcIik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nLmVycm9yKFwibmV3c2xldHRlci5idXR0b25kb3duLmdldF9zdWJzY3JpYmVyLmV4Y2VwdGlvblwiLCB7XG4gICAgICBlcnJvcjogc2VyaWFsaXplRXJyb3IoZXJyb3IpLFxuICAgIH0pO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbImNyZWF0ZUxvZ2dlciIsImVtYWlsVG9Mb2dNZXRhIiwic2VyaWFsaXplRXJyb3IiLCJTRVNTSU9OX01BWF9BR0VfU0VDT05EUyIsInJlc29sdmVCdXR0b25kb3duQXBpQmFzZSIsInJhdyIsInByb2Nlc3MiLCJlbnYiLCJCVVRUT05ET1dOX0FQSV9CQVNFX1VSTCIsInRyaW0iLCJiYXNlIiwicmVwbGFjZSIsIkJVVFRPTkRPV05fQVBJX0JBU0UiLCJub3JtYWxpemVCdXR0b25kb3duQXBpS2V5IiwidmFsdWUiLCJ0b2tlbiIsIkJVVFRPTkRPV05fQVBJX1RPS0VOIiwiQlVUVE9ORE9XTl9BUElfS0VZIiwiQlVUVE9ORE9XTl9BVVRIX0hFQURFUiIsIlNVQlNDUklCRURfQ09PS0lFX05BTUUiLCJTVUJTQ1JJQkVEX0NPT0tJRV9NQVhfQUdFX1NFQ09ORFMiLCJzdWJzY3JpYmVkQ29va2llT3B0aW9ucyIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJzZWN1cmUiLCJwYXRoIiwibWF4QWdlIiwiUExBQ0VIT0xERVJfVEFHUyIsIlBMQUNFSE9MREVSX01FVEFEQVRBIiwiaXNWYWxpZEVtYWlsIiwiZW1haWwiLCJpbmNsdWRlcyIsIlNVQlNDUklCRVJfVFlQRSIsImJ1aWxkU3Vic2NyaWJlclVybCIsImlkT3JFbWFpbCIsImVuY29kZVVSSUNvbXBvbmVudCIsImJ1aWxkQXR0cmlidXRpb24iLCJyZXR1cm5UbyIsIm9yaWdpbiIsInVybCIsIlVSTCIsInBhcmFtcyIsInNlYXJjaFBhcmFtcyIsImF0dHJpYnV0aW9uIiwicmVmZXJyZXJfdXJsIiwidG9TdHJpbmciLCJ1dG1Tb3VyY2UiLCJnZXQiLCJ1dG1NZWRpdW0iLCJ1dG1DYW1wYWlnbiIsInV0bVRlcm0iLCJ1dG1Db250ZW50IiwidXRtX3NvdXJjZSIsInV0bV9tZWRpdW0iLCJ1dG1fY2FtcGFpZ24iLCJ1dG1fdGVybSIsInV0bV9jb250ZW50IiwicmVhZEJ1dHRvbmRvd25FcnJvciIsInJlc3BvbnNlIiwiYm9keSIsImpzb24iLCJkZXRhaWwiLCJtZXNzYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsInRleHQiLCJpc0FscmVhZHlTdWJzY3JpYmVkIiwibm9ybWFsaXplZCIsInRvTG93ZXJDYXNlIiwidXBkYXRlRXhpc3RpbmdTdWJzY3JpYmVyIiwibG9nZ2VyIiwibG9nIiwic2NvcGUiLCJjaGlsZCIsImVycm9yIiwic3RhdHVzIiwicGF5bG9hZCIsInR5cGUiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwib2siLCJkZWJ1ZyIsIndhcm4iLCJFcnJvciIsInN1YnNjcmliZVRvQnV0dG9uZG93biIsImVtYWlsTWV0YSIsImhhc1JldHVyblRvIiwiQm9vbGVhbiIsImhhc09yaWdpbiIsImVtYWlsX2FkZHJlc3MiLCJsZW5ndGgiLCJ0YWdzIiwiT2JqZWN0Iiwia2V5cyIsIm1ldGFkYXRhIiwidXBkYXRlUmVzdWx0IiwiZ2V0QnV0dG9uZG93blN1YnNjcmliZXIiLCJpZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/newsletter/buttondown.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fcallback%2Froute&page=%2Fapi%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fcallback%2Froute.ts&appDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fcallback%2Froute&page=%2Fapi%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fcallback%2Froute.ts&appDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/./node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_server_app_render_manifests_singleton__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/app-render/manifests-singleton */ \"(rsc)/./node_modules/next/dist/server/app-render/manifests-singleton.js\");\n/* harmony import */ var next_dist_server_app_render_manifests_singleton__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_app_render_manifests_singleton__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/./node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/./node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/./node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/./node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/./node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_12__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/./node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/./node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/./node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_16___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_16__);\n/* harmony import */ var _Users_ryanrosztoczy_Development_mainstreetai_website_apps_members_app_api_auth_callback_route_ts__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./app/api/auth/callback/route.ts */ \"(rsc)/./app/api/auth/callback/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/callback/route\",\n        pathname: \"/api/auth/callback\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/callback/route\"\n    },\n    distDir: \".next/dev\" || 0,\n    relativeProjectDir:  false || '',\n    resolvedPagePath: \"/Users/ryanrosztoczy/Development/mainstreetai-website/apps/members/app/api/auth/callback/route.ts\",\n    nextConfigOutput,\n    userland: _Users_ryanrosztoczy_Development_mainstreetai_website_apps_members_app_api_auth_callback_route_ts__WEBPACK_IMPORTED_MODULE_17__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.addRequestMeta)(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/auth/callback/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = false;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_6__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_15__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        (0,next_dist_server_app_render_manifests_singleton__WEBPACK_IMPORTED_MODULE_5__.setManifestsSingleton)({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext, silenceLog)=>routeModule.onRequestError(req, error, errorContext, silenceLog, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_7__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_7__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_8__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_8__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_9__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean( false || (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_12__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_16__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_11__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        const silenceLog = false;\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_10__.getRevalidateReason)({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, silenceLog, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_16__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_12__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_14__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_13__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_11__.sendResponse)(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_9__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_15__.NoFallbackError)) {\n            const silenceLog = false;\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_10__.getRevalidateReason)({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            }, silenceLog, routerServerContext);\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_11__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGY2FsbGJhY2slMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZjYWxsYmFjayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZjYWxsYmFjayUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnJ5YW5yb3N6dG9jenklMkZEZXZlbG9wbWVudCUyRm1haW5zdHJlZXRhaS13ZWJzaXRlJTJGYXBwcyUyRm1lbWJlcnMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGcnlhbnJvc3p0b2N6eSUyRkRldmVsb3BtZW50JTJGbWFpbnN0cmVldGFpLXdlYnNpdGUlMkZhcHBzJTJGbWVtYmVycyZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD0mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEJmlzR2xvYmFsTm90Rm91bmRFbmFibGVkPSEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNFO0FBQ1A7QUFDZ0I7QUFDVDtBQUNLO0FBQ21DO0FBQ2pEO0FBQ087QUFDZjtBQUNzQztBQUN6QjtBQUNNO0FBQ0M7QUFDaEI7QUFDNEQ7QUFDOUg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsYUFBYSxXQUFvQyxJQUFJ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cUksNkVBQWU7QUFDcEo7QUFDQSwyR0FBMkcsaUhBQWlIO0FBQzVOO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHdGQUEyQjtBQUN2RDtBQUNBLCtCQUErQiw0RUFBc0I7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsMEZBQXFCO0FBQ2xFO0FBQ0Esa0JBQWtCLDZFQUFZO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ04sNkJBQTZCLDZGQUFlO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsNEZBQW1CO0FBQ3JEO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDZFQUFZO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCB7IGFkZFJlcXVlc3RNZXRhLCBnZXRSZXF1ZXN0TWV0YSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JlcXVlc3QtbWV0YVwiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IHNldE1hbmlmZXN0c1NpbmdsZXRvbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2FwcC1yZW5kZXIvbWFuaWZlc3RzLXNpbmdsZXRvblwiO1xuaW1wb3J0IHsgbm9ybWFsaXplQXBwUGF0aCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2hhcmVkL2xpYi9yb3V0ZXIvdXRpbHMvYXBwLXBhdGhzXCI7XG5pbXBvcnQgeyBOb2RlTmV4dFJlcXVlc3QsIE5vZGVOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9iYXNlLWh0dHAvbm9kZVwiO1xuaW1wb3J0IHsgTmV4dFJlcXVlc3RBZGFwdGVyLCBzaWduYWxGcm9tTm9kZVJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvd2ViL3NwZWMtZXh0ZW5zaW9uL2FkYXB0ZXJzL25leHQtcmVxdWVzdFwiO1xuaW1wb3J0IHsgQmFzZVNlcnZlclNwYW4gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBnZXRSZXZhbGlkYXRlUmVhc29uIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvaW5zdHJ1bWVudGF0aW9uL3V0aWxzXCI7XG5pbXBvcnQgeyBzZW5kUmVzcG9uc2UgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9zZW5kLXJlc3BvbnNlXCI7XG5pbXBvcnQgeyBmcm9tTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMsIHRvTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci93ZWIvdXRpbHNcIjtcbmltcG9ydCB7IGdldENhY2hlQ29udHJvbEhlYWRlciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9jYWNoZS1jb250cm9sXCI7XG5pbXBvcnQgeyBJTkZJTklURV9DQUNIRSwgTkVYVF9DQUNIRV9UQUdTX0hFQURFUiB9IGZyb20gXCJuZXh0L2Rpc3QvbGliL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgTm9GYWxsYmFja0Vycm9yIH0gZnJvbSBcIm5leHQvZGlzdC9zaGFyZWQvbGliL25vLWZhbGxiYWNrLWVycm9yLmV4dGVybmFsXCI7XG5pbXBvcnQgeyBDYWNoZWRSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yZXNwb25zZS1jYWNoZVwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9yeWFucm9zenRvY3p5L0RldmVsb3BtZW50L21haW5zdHJlZXRhaS13ZWJzaXRlL2FwcHMvbWVtYmVycy9hcHAvYXBpL2F1dGgvY2FsbGJhY2svcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvY2FsbGJhY2svcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL2NhbGxiYWNrXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL2NhbGxiYWNrL3JvdXRlXCJcbiAgICB9LFxuICAgIGRpc3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9ESVNUX0RJUiB8fCAnJyxcbiAgICByZWxhdGl2ZVByb2plY3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9QUk9KRUNUX0RJUiB8fCAnJyxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9yeWFucm9zenRvY3p5L0RldmVsb3BtZW50L21haW5zdHJlZXRhaS13ZWJzaXRlL2FwcHMvbWVtYmVycy9hcHAvYXBpL2F1dGgvY2FsbGJhY2svcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcywgY3R4KSB7XG4gICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgIGFkZFJlcXVlc3RNZXRhKHJlcSwgJ2RldlJlcXVlc3RUaW1pbmdJbnRlcm5hbHNFbmQnLCBwcm9jZXNzLmhydGltZS5iaWdpbnQoKSk7XG4gICAgfVxuICAgIGxldCBzcmNQYWdlID0gXCIvYXBpL2F1dGgvY2FsbGJhY2svcm91dGVcIjtcbiAgICAvLyB0dXJib3BhY2sgZG9lc24ndCBub3JtYWxpemUgYC9pbmRleGAgaW4gdGhlIHBhZ2UgbmFtZVxuICAgIC8vIHNvIHdlIG5lZWQgdG8gdG8gcHJvY2VzcyBkeW5hbWljIHJvdXRlcyBwcm9wZXJseVxuICAgIC8vIFRPRE86IGZpeCB0dXJib3BhY2sgcHJvdmlkaW5nIGRpZmZlcmluZyB2YWx1ZSBmcm9tIHdlYnBhY2tcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFVSQk9QQUNLKSB7XG4gICAgICAgIHNyY1BhZ2UgPSBzcmNQYWdlLnJlcGxhY2UoL1xcL2luZGV4JC8sICcnKSB8fCAnLyc7XG4gICAgfSBlbHNlIGlmIChzcmNQYWdlID09PSAnL2luZGV4Jykge1xuICAgICAgICAvLyB3ZSBhbHdheXMgbm9ybWFsaXplIC9pbmRleCBzcGVjaWZpY2FsbHlcbiAgICAgICAgc3JjUGFnZSA9ICcvJztcbiAgICB9XG4gICAgY29uc3QgbXVsdGlab25lRHJhZnRNb2RlID0gcHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERTtcbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlLFxuICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGVcbiAgICB9KTtcbiAgICBpZiAoIXByZXBhcmVSZXN1bHQpIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgICAgIHJlcy5lbmQoJ0JhZCBSZXF1ZXN0Jyk7XG4gICAgICAgIGN0eC53YWl0VW50aWwgPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC53YWl0VW50aWwuY2FsbChjdHgsIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgYnVpbGRJZCwgcGFyYW1zLCBuZXh0Q29uZmlnLCBwYXJzZWRVcmwsIGlzRHJhZnRNb2RlLCBwcmVyZW5kZXJNYW5pZmVzdCwgcm91dGVyU2VydmVyQ29udGV4dCwgaXNPbkRlbWFuZFJldmFsaWRhdGUsIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLCByZXNvbHZlZFBhdGhuYW1lLCBjbGllbnRSZWZlcmVuY2VNYW5pZmVzdCwgc2VydmVyQWN0aW9uc01hbmlmZXN0IH0gPSBwcmVwYXJlUmVzdWx0O1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRTcmNQYWdlID0gbm9ybWFsaXplQXBwUGF0aChzcmNQYWdlKTtcbiAgICBsZXQgaXNJc3IgPSBCb29sZWFuKHByZXJlbmRlck1hbmlmZXN0LmR5bmFtaWNSb3V0ZXNbbm9ybWFsaXplZFNyY1BhZ2VdIHx8IHByZXJlbmRlck1hbmlmZXN0LnJvdXRlc1tyZXNvbHZlZFBhdGhuYW1lXSk7XG4gICAgY29uc3QgcmVuZGVyNDA0ID0gYXN5bmMgKCk9PntcbiAgICAgICAgLy8gVE9ETzogc2hvdWxkIHJvdXRlLW1vZHVsZSBpdHNlbGYgaGFuZGxlIHJlbmRlcmluZyB0aGUgNDA0XG4gICAgICAgIGlmIChyb3V0ZXJTZXJ2ZXJDb250ZXh0ID09IG51bGwgPyB2b2lkIDAgOiByb3V0ZXJTZXJ2ZXJDb250ZXh0LnJlbmRlcjQwNCkge1xuICAgICAgICAgICAgYXdhaXQgcm91dGVyU2VydmVyQ29udGV4dC5yZW5kZXI0MDQocmVxLCByZXMsIHBhcnNlZFVybCwgZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzLmVuZCgnVGhpcyBwYWdlIGNvdWxkIG5vdCBiZSBmb3VuZCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgaWYgKGlzSXNyICYmICFpc0RyYWZ0TW9kZSkge1xuICAgICAgICBjb25zdCBpc1ByZXJlbmRlcmVkID0gQm9vbGVhbihwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXNbcmVzb2x2ZWRQYXRobmFtZV0pO1xuICAgICAgICBjb25zdCBwcmVyZW5kZXJJbmZvID0gcHJlcmVuZGVyTWFuaWZlc3QuZHluYW1pY1JvdXRlc1tub3JtYWxpemVkU3JjUGFnZV07XG4gICAgICAgIGlmIChwcmVyZW5kZXJJbmZvKSB7XG4gICAgICAgICAgICBpZiAocHJlcmVuZGVySW5mby5mYWxsYmFjayA9PT0gZmFsc2UgJiYgIWlzUHJlcmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENvbmZpZy5leHBlcmltZW50YWwuYWRhcHRlclBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlbmRlcjQwNCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9GYWxsYmFja0Vycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IGNhY2hlS2V5ID0gbnVsbDtcbiAgICBpZiAoaXNJc3IgJiYgIXJvdXRlTW9kdWxlLmlzRGV2ICYmICFpc0RyYWZ0TW9kZSkge1xuICAgICAgICBjYWNoZUtleSA9IHJlc29sdmVkUGF0aG5hbWU7XG4gICAgICAgIC8vIGVuc3VyZSAvaW5kZXggYW5kIC8gaXMgbm9ybWFsaXplZCB0byBvbmUga2V5XG4gICAgICAgIGNhY2hlS2V5ID0gY2FjaGVLZXkgPT09ICcvaW5kZXgnID8gJy8nIDogY2FjaGVLZXk7XG4gICAgfVxuICAgIGNvbnN0IHN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlID0gLy8gSWYgd2UncmUgaW4gZGV2ZWxvcG1lbnQsIHdlIGFsd2F5cyBzdXBwb3J0IGR5bmFtaWMgSFRNTFxuICAgIHJvdXRlTW9kdWxlLmlzRGV2ID09PSB0cnVlIHx8IC8vIElmIHRoaXMgaXMgbm90IFNTRyBvciBkb2VzIG5vdCBoYXZlIHN0YXRpYyBwYXRocywgdGhlbiBpdCBzdXBwb3J0c1xuICAgIC8vIGR5bmFtaWMgSFRNTC5cbiAgICAhaXNJc3I7XG4gICAgLy8gVGhpcyBpcyBhIHJldmFsaWRhdGlvbiByZXF1ZXN0IGlmIHRoZSByZXF1ZXN0IGlzIGZvciBhIHN0YXRpY1xuICAgIC8vIHBhZ2UgYW5kIGl0IGlzIG5vdCBiZWluZyByZXN1bWVkIGZyb20gYSBwb3N0cG9uZWQgcmVuZGVyIGFuZFxuICAgIC8vIGl0IGlzIG5vdCBhIGR5bmFtaWMgUlNDIHJlcXVlc3QgdGhlbiBpdCBpcyBhIHJldmFsaWRhdGlvblxuICAgIC8vIHJlcXVlc3QuXG4gICAgY29uc3QgaXNTdGF0aWNHZW5lcmF0aW9uID0gaXNJc3IgJiYgIXN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlO1xuICAgIC8vIEJlZm9yZSByZW5kZXJpbmcgKHdoaWNoIGluaXRpYWxpemVzIGNvbXBvbmVudCB0cmVlIG1vZHVsZXMpLCB3ZSBoYXZlIHRvXG4gICAgLy8gc2V0IHRoZSByZWZlcmVuY2UgbWFuaWZlc3RzIHRvIG91ciBnbG9iYWwgc3RvcmUgc28gU2VydmVyIEFjdGlvbidzXG4gICAgLy8gZW5jcnlwdGlvbiB1dGlsIGNhbiBhY2Nlc3MgdG8gdGhlbSBhdCB0aGUgdG9wIGxldmVsIG9mIHRoZSBwYWdlIG1vZHVsZS5cbiAgICBpZiAoc2VydmVyQWN0aW9uc01hbmlmZXN0ICYmIGNsaWVudFJlZmVyZW5jZU1hbmlmZXN0KSB7XG4gICAgICAgIHNldE1hbmlmZXN0c1NpbmdsZXRvbih7XG4gICAgICAgICAgICBwYWdlOiBzcmNQYWdlLFxuICAgICAgICAgICAgY2xpZW50UmVmZXJlbmNlTWFuaWZlc3QsXG4gICAgICAgICAgICBzZXJ2ZXJBY3Rpb25zTWFuaWZlc3RcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZCA9IHJlcS5tZXRob2QgfHwgJ0dFVCc7XG4gICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgY29uc3QgYWN0aXZlU3BhbiA9IHRyYWNlci5nZXRBY3RpdmVTY29wZVNwYW4oKTtcbiAgICBjb25zdCBjb250ZXh0ID0ge1xuICAgICAgICBwYXJhbXMsXG4gICAgICAgIHByZXJlbmRlck1hbmlmZXN0LFxuICAgICAgICByZW5kZXJPcHRzOiB7XG4gICAgICAgICAgICBleHBlcmltZW50YWw6IHtcbiAgICAgICAgICAgICAgICBhdXRoSW50ZXJydXB0czogQm9vbGVhbihuZXh0Q29uZmlnLmV4cGVyaW1lbnRhbC5hdXRoSW50ZXJydXB0cylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWNoZUNvbXBvbmVudHM6IEJvb2xlYW4obmV4dENvbmZpZy5jYWNoZUNvbXBvbmVudHMpLFxuICAgICAgICAgICAgc3VwcG9ydHNEeW5hbWljUmVzcG9uc2UsXG4gICAgICAgICAgICBpbmNyZW1lbnRhbENhY2hlOiBnZXRSZXF1ZXN0TWV0YShyZXEsICdpbmNyZW1lbnRhbENhY2hlJyksXG4gICAgICAgICAgICBjYWNoZUxpZmVQcm9maWxlczogbmV4dENvbmZpZy5jYWNoZUxpZmUsXG4gICAgICAgICAgICB3YWl0VW50aWw6IGN0eC53YWl0VW50aWwsXG4gICAgICAgICAgICBvbkNsb3NlOiAoY2IpPT57XG4gICAgICAgICAgICAgICAgcmVzLm9uKCdjbG9zZScsIGNiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkFmdGVyVGFza0Vycm9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBvbkluc3RydW1lbnRhdGlvblJlcXVlc3RFcnJvcjogKGVycm9yLCBfcmVxdWVzdCwgZXJyb3JDb250ZXh0LCBzaWxlbmNlTG9nKT0+cm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnJvciwgZXJyb3JDb250ZXh0LCBzaWxlbmNlTG9nLCByb3V0ZXJTZXJ2ZXJDb250ZXh0KVxuICAgICAgICB9LFxuICAgICAgICBzaGFyZWRDb250ZXh0OiB7XG4gICAgICAgICAgICBidWlsZElkXG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IG5vZGVOZXh0UmVxID0gbmV3IE5vZGVOZXh0UmVxdWVzdChyZXEpO1xuICAgIGNvbnN0IG5vZGVOZXh0UmVzID0gbmV3IE5vZGVOZXh0UmVzcG9uc2UocmVzKTtcbiAgICBjb25zdCBuZXh0UmVxID0gTmV4dFJlcXVlc3RBZGFwdGVyLmZyb21Ob2RlTmV4dFJlcXVlc3Qobm9kZU5leHRSZXEsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UocmVzKSk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW52b2tlUm91dGVNb2R1bGUgPSBhc3luYyAoc3Bhbik9PntcbiAgICAgICAgICAgIHJldHVybiByb3V0ZU1vZHVsZS5oYW5kbGUobmV4dFJlcSwgY29udGV4dCkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtzcmNQYWdlfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBpc01pbmltYWxNb2RlID0gQm9vbGVhbihwcm9jZXNzLmVudi5NSU5JTUFMX01PREUgfHwgZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSk7XG4gICAgICAgIGNvbnN0IGhhbmRsZVJlc3BvbnNlID0gYXN5bmMgKGN1cnJlbnRTcGFuKT0+e1xuICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VHZW5lcmF0b3IgPSBhc3luYyAoeyBwcmV2aW91c0NhY2hlRW50cnkgfSk9PntcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTWluaW1hbE1vZGUgJiYgaXNPbkRlbWFuZFJldmFsaWRhdGUgJiYgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQgJiYgIXByZXZpb3VzQ2FjaGVFbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbi1kZW1hbmQgcmV2YWxpZGF0ZSBhbHdheXMgc2V0cyB0aGlzIGhlYWRlclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCAnUkVWQUxJREFURUQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoJ1RoaXMgcGFnZSBjb3VsZCBub3QgYmUgZm91bmQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoY3VycmVudFNwYW4pO1xuICAgICAgICAgICAgICAgICAgICByZXEuZmV0Y2hNZXRyaWNzID0gY29udGV4dC5yZW5kZXJPcHRzLmZldGNoTWV0cmljcztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBlbmRpbmdXYWl0VW50aWwgPSBjb250ZXh0LnJlbmRlck9wdHMucGVuZGluZ1dhaXRVbnRpbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB1c2luZyBwcm92aWRlZCB3YWl0VW50aWwgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3Mgbm90IHdlIGZhbGxiYWNrIHRvIHNlbmRSZXNwb25zZSdzIGhhbmRsaW5nXG4gICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nV2FpdFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3R4LndhaXRVbnRpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC53YWl0VW50aWwocGVuZGluZ1dhaXRVbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1dhaXRVbnRpbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZVRhZ3MgPSBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkVGFncztcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3RhdGljIHJlc3BvbnNlLCB3ZSBjYW4gY2FjaGUgaXQgc28gbG9uZ1xuICAgICAgICAgICAgICAgICAgICAvLyBhcyBpdCdzIG5vdCBlZGdlLlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNJc3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBoZWFkZXJzIGZyb20gdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHRvTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMocmVzcG9uc2UuaGVhZGVycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVUYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tORVhUX0NBQ0hFX1RBR1NfSEVBREVSXSA9IGNhY2hlVGFncztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGVhZGVyc1snY29udGVudC10eXBlJ10gJiYgYmxvYi50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSBibG9iLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXZhbGlkYXRlID0gdHlwZW9mIGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlID09PSAndW5kZWZpbmVkJyB8fCBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZSA+PSBJTkZJTklURV9DQUNIRSA/IGZhbHNlIDogY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBpcmUgPSB0eXBlb2YgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA9PT0gJ3VuZGVmaW5lZCcgfHwgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA+PSBJTkZJTklURV9DQUNIRSA/IHVuZGVmaW5lZCA6IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGNhY2hlIGVudHJ5IGZvciB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZUVudHJ5ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IENhY2hlZFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBCdWZmZXIuZnJvbShhd2FpdCBibG9iLmFycmF5QnVmZmVyKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZUNvbnRyb2w6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZUVudHJ5O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCByZXNwb25zZSB3aXRob3V0IGNhY2hpbmcgaWYgbm90IElTUlxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgcmVzcG9uc2UsIGNvbnRleHQucmVuZGVyT3B0cy5wZW5kaW5nV2FpdFVudGlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBiYWNrZ3JvdW5kIHJldmFsaWRhdGUgd2UgbmVlZCB0byByZXBvcnRcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHJlcXVlc3QgZXJyb3IgaGVyZSBhcyBpdCB3b24ndCBiZSBidWJibGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c0NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IHByZXZpb3VzQ2FjaGVFbnRyeS5pc1N0YWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWxlbmNlTG9nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVyciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcktpbmQ6ICdBcHAgUm91dGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVBhdGg6IHNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N0YXRpY0dlbmVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHNpbGVuY2VMb2csIHJvdXRlclNlcnZlckNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IGF3YWl0IHJvdXRlTW9kdWxlLmhhbmRsZVJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgICAgbmV4dENvbmZpZyxcbiAgICAgICAgICAgICAgICBjYWNoZUtleSxcbiAgICAgICAgICAgICAgICByb3V0ZUtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgaXNGYWxsYmFjazogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgICAgICAgICAgaXNSb3V0ZVBQUkVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbCxcbiAgICAgICAgICAgICAgICBpc01pbmltYWxNb2RlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHdlIGRvbid0IGNyZWF0ZSBhIGNhY2hlRW50cnkgZm9yIElTUlxuICAgICAgICAgICAgaWYgKCFpc0lzcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChjYWNoZUVudHJ5ID09IG51bGwgPyB2b2lkIDAgOiAoX2NhY2hlRW50cnlfdmFsdWUgPSBjYWNoZUVudHJ5LnZhbHVlKSA9PSBudWxsID8gdm9pZCAwIDogX2NhY2hlRW50cnlfdmFsdWUua2luZCkgIT09IENhY2hlZFJvdXRlS2luZC5BUFBfUk9VVEUpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2NhY2hlRW50cnlfdmFsdWUxO1xuICAgICAgICAgICAgICAgIHRocm93IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXcgRXJyb3IoYEludmFyaWFudDogYXBwLXJvdXRlIHJlY2VpdmVkIGludmFsaWQgY2FjaGUgZW50cnkgJHtjYWNoZUVudHJ5ID09IG51bGwgPyB2b2lkIDAgOiAoX2NhY2hlRW50cnlfdmFsdWUxID0gY2FjaGVFbnRyeS52YWx1ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jYWNoZUVudHJ5X3ZhbHVlMS5raW5kfWApLCBcIl9fTkVYVF9FUlJPUl9DT0RFXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwiRTcwMVwiLFxuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWlzTWluaW1hbE1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCd4LW5leHRqcy1jYWNoZScsIGlzT25EZW1hbmRSZXZhbGlkYXRlID8gJ1JFVkFMSURBVEVEJyA6IGNhY2hlRW50cnkuaXNNaXNzID8gJ01JU1MnIDogY2FjaGVFbnRyeS5pc1N0YWxlID8gJ1NUQUxFJyA6ICdISVQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERyYWZ0IG1vZGUgc2hvdWxkIG5ldmVyIGJlIGNhY2hlZFxuICAgICAgICAgICAgaWYgKGlzRHJhZnRNb2RlKSB7XG4gICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ2FjaGUtQ29udHJvbCcsICdwcml2YXRlLCBuby1jYWNoZSwgbm8tc3RvcmUsIG1heC1hZ2U9MCwgbXVzdC1yZXZhbGlkYXRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gZnJvbU5vZGVPdXRnb2luZ0h0dHBIZWFkZXJzKGNhY2hlRW50cnkudmFsdWUuaGVhZGVycyk7XG4gICAgICAgICAgICBpZiAoIShpc01pbmltYWxNb2RlICYmIGlzSXNyKSkge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMuZGVsZXRlKE5FWFRfQ0FDSEVfVEFHU19IRUFERVIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgY2FjaGUgY29udHJvbCBpcyBhbHJlYWR5IHNldCBvbiB0aGUgcmVzcG9uc2Ugd2UgZG9uJ3RcbiAgICAgICAgICAgIC8vIG92ZXJyaWRlIGl0IHRvIGFsbG93IHVzZXJzIHRvIGN1c3RvbWl6ZSBpdCB2aWEgbmV4dC5jb25maWdcbiAgICAgICAgICAgIGlmIChjYWNoZUVudHJ5LmNhY2hlQ29udHJvbCAmJiAhcmVzLmdldEhlYWRlcignQ2FjaGUtQ29udHJvbCcpICYmICFoZWFkZXJzLmdldCgnQ2FjaGUtQ29udHJvbCcpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVycy5zZXQoJ0NhY2hlLUNvbnRyb2wnLCBnZXRDYWNoZUNvbnRyb2xIZWFkZXIoY2FjaGVFbnRyeS5jYWNoZUNvbnRyb2wpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHNlbmRSZXNwb25zZShub2RlTmV4dFJlcSwgbm9kZU5leHRSZXMsIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBBcmd1bWVudCBvZiB0eXBlICdCdWZmZXI8QXJyYXlCdWZmZXJMaWtlPicgaXMgbm90IGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0JvZHlJbml0IHwgbnVsbCB8IHVuZGVmaW5lZCcuXG4gICAgICAgICAgICBuZXcgUmVzcG9uc2UoY2FjaGVFbnRyeS52YWx1ZS5ib2R5LCB7XG4gICAgICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGNhY2hlRW50cnkudmFsdWUuc3RhdHVzIHx8IDIwMFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRPRE86IGFjdGl2ZVNwYW4gY29kZSBwYXRoIGlzIGZvciB3aGVuIHdyYXBwZWQgYnlcbiAgICAgICAgLy8gbmV4dC1zZXJ2ZXIgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGlzIGlzIG5vIGxvbmdlciB1c2VkXG4gICAgICAgIGlmIChhY3RpdmVTcGFuKSB7XG4gICAgICAgICAgICBhd2FpdCBoYW5kbGVSZXNwb25zZShhY3RpdmVTcGFuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRyYWNlci53aXRoUHJvcGFnYXRlZENvbnRleHQocmVxLmhlYWRlcnMsICgpPT50cmFjZXIudHJhY2UoQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCwge1xuICAgICAgICAgICAgICAgICAgICBzcGFuTmFtZTogYCR7bWV0aG9kfSAke3NyY1BhZ2V9YCxcbiAgICAgICAgICAgICAgICAgICAga2luZDogU3BhbktpbmQuU0VSVkVSLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5tZXRob2QnOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC50YXJnZXQnOiByZXEudXJsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBoYW5kbGVSZXNwb25zZSkpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIE5vRmFsbGJhY2tFcnJvcikpIHtcbiAgICAgICAgICAgIGNvbnN0IHNpbGVuY2VMb2cgPSBmYWxzZTtcbiAgICAgICAgICAgIGF3YWl0IHJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyLCB7XG4gICAgICAgICAgICAgICAgcm91dGVyS2luZDogJ0FwcCBSb3V0ZXInLFxuICAgICAgICAgICAgICAgIHJvdXRlUGF0aDogbm9ybWFsaXplZFNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICBpc1N0YXRpY0dlbmVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sIHNpbGVuY2VMb2csIHJvdXRlclNlcnZlckNvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJldGhyb3cgc28gdGhhdCB3ZSBjYW4gaGFuZGxlIHNlcnZpbmcgZXJyb3IgcGFnZVxuICAgICAgICAvLyBJZiB0aGlzIGlzIGR1cmluZyBzdGF0aWMgZ2VuZXJhdGlvbiwgdGhyb3cgdGhlIGVycm9yIGFnYWluLlxuICAgICAgICBpZiAoaXNJc3IpIHRocm93IGVycjtcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBzZW5kIGEgNTAwIHJlc3BvbnNlLlxuICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDBcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXBcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fcallback%2Froute&page=%2Fapi%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fcallback%2Froute.ts&appDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "node:buffer":
/*!******************************!*\
  !*** external "node:buffer" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:buffer");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:events":
/*!******************************!*\
  !*** external "node:events" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:events");

/***/ }),

/***/ "node:http":
/*!****************************!*\
  !*** external "node:http" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:http");

/***/ }),

/***/ "node:https":
/*!*****************************!*\
  !*** external "node:https" ***!
  \*****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:https");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/stytch","vendor-chunks/jose"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fcallback%2Froute&page=%2Fapi%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fcallback%2Froute.ts&appDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryanrosztoczy%2FDevelopment%2Fmainstreetai-website%2Fapps%2Fmembers&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();